<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>dynamic_graph_manager: 7/ Interfacing with a robot simulator</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">dynamic_graph_manager
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('subpage_robot_simulation.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">7/ Interfacing with a robot simulator </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>A robot implemented with dynamic graph manager doesn't come with a simulator by default.</p>
<p>There are multiple ways and at different levels to implement a simulator:</p><ul>
<li>Implement a simulator in C++ and start it as dynamic graph manager from the console</li>
<li>Create a device in python and use another simulator from python</li>
</ul>
<h1><a class="anchor" id="simu_sec_cpp"></a>
7.1/ Simulator implementation in C++</h1>
<p>For an example, see <a href="https://git-amd.tuebingen.mpg.de/amd-clmc/dynamic_graph_manager/blob/master/demos/single_motor/single_motor_device_simulator.cpp">https://git-amd.tuebingen.mpg.de/amd-clmc/dynamic_graph_manager/blob/master/demos/single_motor/single_motor_device_simulator.cpp</a>.</p>
<h1><a class="anchor" id="simu_sec_python"></a>
7.2/ Device in python</h1>
<p>To test a dynamic graph implementation, one way is to create a Device object in python. This device object is created using the same / a similar robot-yaml file as for the dynamic graph manger's real robot. At every integration step of the simulation, the sensor values must be stored on the sensor signals of the device and the dynamic graph is executed. Last, the control commands must be forwarded to a simulator, the simulator is stepped and the next cycle begins.</p>
<p>The following code shows how to create a device and robot. It also scatches how to do the simulation loop. </p><div class="fragment"><div class="line">from <a class="code" href="namespacedynamic__graph__manager.html">dynamic_graph_manager</a>.device <span class="keyword">import</span> Device</div><div class="line">from <a class="code" href="namespacedynamic__graph__manager.html">dynamic_graph_manager</a>.device.robot <span class="keyword">import</span> Robot</div><div class="line"></div><div class="line"><span class="preprocessor"># Create the device and robot object.</span></div><div class="line">device = Device(<span class="stringliteral">&quot;your_robot_name&quot;</span>)</div><div class="line">device.initialize(&quot;path_to_the_robot_yaml_file.yaml&quot;)</div><div class="line"><a class="code" href="namespacerobot.html">robot</a> = Robot(name=local_device.name, device=local_device)</div><div class="line"></div><div class="line"><span class="preprocessor"># This creates the controllers and plugs the sensor to the control signals etc.</span></div><div class="line">setup_controller(<a class="code" href="namespacerobot.html">robot</a>)</div><div class="line"></div><div class="line"><span class="preprocessor"># Setup your simulator. This might be pybullet etc.</span></div><div class="line">sim = create_simulator()</div><div class="line"></div><div class="line"><span class="preprocessor"># Do the simulation loop. Here, we assume to simulate 4000 steps</span></div><div class="line"><span class="keywordflow">for</span> it in range(4000):</div><div class="line">  # Fill all the sensor signals based on the simulator values.</div><div class="line">  <a class="code" href="namespacerobot.html">robot</a>.device.&lt;join_positions&gt;.value = sim.get_joint_positions()</div><div class="line">  ...</div><div class="line"></div><div class="line">  # Execute the dynamic graph. This computes the control output.</div><div class="line">  <a class="code" href="namespacerobot.html">robot</a>.device.executeGraph()</div><div class="line"></div><div class="line">  # Pass the computed control signals to the simulator.</div><div class="line">  sim.control(<a class="code" href="namespacerobot.html">robot</a>.device.&lt;ctrl_commands&gt;.value)</div><div class="line"></div><div class="line">  # Step the simulator by one dt.</div><div class="line">  sim.step()</div></div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">Dynamic Graph Manager</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
