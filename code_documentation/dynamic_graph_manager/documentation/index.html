<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>dynamic_graph_manager: Dynamic Graph Manager</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">dynamic_graph_manager
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('index.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Dynamic Graph Manager </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#intro_sec_general_introduction">1/ General Introduction</a><ul><li class="level2"><a href="#intro_sec_introduction">1.1/ Introduction</a></li>
<li class="level2"><a href="#intro_sec_dg_general_knowledge">1.2/ General knowledge about the dynamic graph</a><ul><li class="level3"><a href="#intro_subsec_graph">1.2.1/ The dynamic-graph is ... a graph</a></li>
<li class="level3"><a href="#intro_subsec_vocabulary">1.2.2/ A bit of vocabulary</a></li>
<li class="level3"><a href="#intro_subsec_use">1.2.3/ Typical use of the dynamic graph / Hardware communication</a></li>
</ul>
</li>
<li class="level2"><a href="#intro_sec_how_it_works">1.3/ How does it works?</a><ul><li class="level3"><a href="#intro_subsec_pool_entities">1.3.1/ The pool of entities</a></li>
<li class="level3"><a href="#intro_subsec_back_propagation">1.3.2/ Back propagation of the signal call</a></li>
<li class="level3"><a href="#intro_subsec_commands">1.3.3/ The concept of a command</a></li>
<li class="level3"><a href="#intro_subsec_python">1.3.4/ C++ controller, but dynamic Python setup</a></li>
</ul>
</li>
<li class="level2"><a href="#intro_sec_dgm">1.4/ The dynamic_graph_manager</a></li>
<li class="level2"><a href="#intro_sec_structure">1.5/ Structure of the documentation</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="intro_sec_general_introduction"></a>
1/ General Introduction</h1>
<h2><a class="anchor" id="intro_sec_introduction"></a>
1.1/ Introduction</h2>
<p>The pupose of this pacakge is to provide a simple interface between the drivers of a robots and a controller based on the dynamic-graph LAAS-CNRS framework. This documentation page is therefore based on <a href="http://stack-of-tasks.github.io/documentation/e_api.html">http://stack-of-tasks.github.io/documentation/e_api.html</a>. Please visit this web site if you have code question about the LAAS packages. A talk that present this page is available here: <a href="http://replay.vidyo.tuebingen.mpg.de/replay/showRecordingExternal">http://replay.vidyo.tuebingen.mpg.de/replay/showRecordingExternal</a>. html?key=KEnam4DBoewz76u</p>
<p>If anything is not clear in this documentation please ask Maximilien Naveau or Vincent Berenz.</p>
<h2><a class="anchor" id="intro_sec_dg_general_knowledge"></a>
1.2/ General knowledge about the dynamic graph</h2>
<h3><a class="anchor" id="intro_subsec_graph"></a>
1.2.1/ The dynamic-graph is ... a graph</h3>
<div class="image">
<img src="robot_state_reference_from_slider.jpeg" alt="robot_state_reference_from_slider.jpeg"/>
<div class="caption">
Figure 1: Example of a graph based on https://git-amd.tuebingen.mpg.de/amd-clmc/dg_demos/blob/master/python/dg_demos/filter_graph.py.</div></div>
<p> The above figure depicts a simple graph that takes as input a vector of 4 dimension containing 4 doubles (e.g. user inputs from some slider) and output a desired configuration for a quadruped robot. First step consist in filtering it and scale it to the desired reference. Then we define the hip joints to be the reference from the scaled_slider. The knee are a scaled version of the hip (knee_joint = hip_joint * (-2)). Then we concatenate the signals back to one simple vector which will be the reference state of fro a quadruped robot.</p>
<p>The idea of having a graph is that once a part of the graph works, it can be concatenated and can be seen as a simple node. The other powerful thing about graphs is that they can be conceptually easy to understand (not easy to use nor debug but everyone knows what a graph is ^^). The dynamic graph IS therefore a GRAPH, so it has inputs and outputs. Typically the inputs of the graph we will use are the robot sensors, and its outputs are the motor controls. Which boils down to the definition of a controller. For example, a simple graph would read the robot joint states and velocities and compute a PD controller resulting in a torque output. The concept is actually more general: A control graph is made up of no des , which consume and emit signals. For instance, it is also possible to implement a filter. Such a filter would consume the current robot state and perform a smoothing on the state measurements.</p>
<p>In the next section we will describe the vocabulary that is used with the dynamic-graph.</p>
<h3><a class="anchor" id="intro_subsec_vocabulary"></a>
1.2.2/ A bit of vocabulary</h3>
<div class="image">
<img src="vocabulary_graph.png" alt="vocabulary_graph.png"/>
<div class="caption">
Figure 2: This simple graph shows the vocabulary associated with the dynamic graph.</div></div>
<p> Figure 2 summarizes the different notions used in the dynamic graph. There definitions are the following:</p><ul>
<li>Signals: These are arrows (see figure 1 and figure2)</li>
<li>Input signals: These are sockets for a node. These represent object where an output signal can be plugged in. Nodes defines only there own sockets during the setup time. output signals: These are signal emitting from a node. Nodes defines only there own output signals during the setup time.</li>
<li>Entity: An entity a node of the graph. Each node executes a bit of code. Control Graph: A structure of Entities and signals plugged together is a controller.</li>
<li>User command: A command is a non-real time punctual list of instructions. It is used to interact with entities and modify their inner states. Setup time: This is time during which the user sets up the graph. The graph <b>IS NOT / MUST NOT BE</b> running yet.</li>
<li>Plug: The fact of plugging an input signal with an output signal allow the user to define dynamically the flow of information in the graph.</li>
</ul>
<h3><a class="anchor" id="intro_subsec_use"></a>
1.2.3/ Typical use of the dynamic graph / Hardware communication</h3>
<p>The "outside" of the graph is typically considered as the robot hardware. An abstraction of this "hardware", which can be virtually anything, is done by configuring the sensors and controls as signals. So in essence we create an entity that will access the hardware sensors and feed them to the graph as output signals and get back the controls as input signals. In order to configure automatically this entity we used a YAML file. We are thinking about a way to create this class from a YAML file, which would be more consistent because the urdf format is very standard.</p>
<h2><a class="anchor" id="intro_sec_how_it_works"></a>
1.3/ How does it works?</h2>
<h3><a class="anchor" id="intro_subsec_pool_entities"></a>
1.3.1/ The pool of entities</h3>
<p>The dynamic graph uses the concept of singletons (<a href="https://en.wikipedia.org/wiki/Singleton_pattern">https://en.wikipedia.org/wiki/Singleton_pattern</a>):</p>
<div class="fragment"><div class="line">Wikipedia definition:</div><div class="line"></div><div class="line">In software engineering, the singleton pattern is a software</div><div class="line">design pattern that restricts the instantiation of a <span class="keyword">class </span>to one</div><div class="line">&quot;single&quot; instance. This is useful when exactly one object is</div><div class="line">needed to coordinate actions across the system. The term</div><div class="line">comes from the mathematical concept of a singleton.</div></div><!-- fragment --><p>The concept of singleton is also useful to define a unique global variable with a specific API. Meaning that all pieces of the code can have access to the same object (a global variable), but are able to interact with it only with a specific API. The pool of entities is a singleton which manages the memory of all the entities. The pool defines each instances by an identifier (a string) and stores it.</p>
<div class="fragment"><div class="line">WARNING:</div><div class="line"></div><div class="line">Which is why one cannot create 2 entities with the same name.</div></div><!-- fragment --><p>The pool has therefore the capabilities of extracting the pointer to your instances and give it back to you if you lost this pointer.</p>
<div class="fragment"><div class="line">WARNING:</div><div class="line"></div><div class="line">Therefore all instances of entities can be considered as <span class="stringliteral">&quot;global variables&quot;</span></div></div><!-- fragment --><h3><a class="anchor" id="intro_subsec_back_propagation"></a>
1.3.2/ Back propagation of the signal call</h3>
<div class="image">
<img src="robot_state_reference_from_slider_zoom.jpeg" alt="robot_state_reference_from_slider_zoom.jpeg"/>
<div class="caption">
Figure 3: Zoom of the end of the graph depicted in figure 1</div></div>
<p> Consider the graph above (figure 3). In this graph the output signal of robot_des_state is not represented but in this particular case let us call it "sout" like "signal out". In order to execute the complete graph in figure 1 one needs to call for an update of the final output signal. Meaning that one will call: </p><div class="fragment"><div class="line">robot_des_state.sout.recompute(current_time)</div></div><!-- fragment --><p> This will trigger a the evaluation of a callback method in the robot_des_ state entity if current_time&gt;last_recomputed_time. This time management allows you to change the period of reevaluation of each signals.</p>
<p>Let us now assume we triggered the evaluation of robot_des_state.sout with a big enough time "<b>T</b>" number so the callback function is evaluated. This callback function needs to acquire the value of <em>robot_des_state.sin1</em> and <em>robot_des_state.sin2</em> at time <b>T</b>. The fact that front_legs_state.sout is plugged to robot_des_state.sin1 imply that when robot_des_state.sin1 data is accessed front_legs_state. sout will be recomputed at time T to provide the data.</p>
<div class="fragment"><div class="line">INFORMATION:</div><div class="line"></div><div class="line">Therefore the evaluation of one output signal recursively</div><div class="line">trigger the <span class="stringliteral">&quot;Left part of the graph&quot;</span></div></div><!-- fragment --><h3><a class="anchor" id="intro_subsec_commands"></a>
1.3.3/ The concept of a command</h3>
<p>So far the idea is that the last output signal provides the command to the robot which supposed to happen periodically. The purpose of a command is to manage asynchronous event. Typically a user command. For example on has implemented a filter like in figure 2. A user command will be helpful for 2 things:</p><ol type="1">
<li>The user needs a specific initialization, like setting the size of the filter buffer (resize command in green in figure 2).</li>
<li>The user needs to punctually access internal values of an entity.</li>
</ol>
<p>In the first case the command will modify the inner structure of the entity. In the second case the command will just read the internal structure of the entity.</p>
<h3><a class="anchor" id="intro_subsec_python"></a>
1.3.4/ C++ controller, but dynamic Python setup</h3>
<p>In dynamic graph (DG) the <b>entities</b> are implemented using <b>C++</b>. So the final graph which is the controller runs all in fast C++. This is the reason why we can run it in <b> real time </b> on <b> real hardware </b>. From these C++ <b>entities</b> , there is an automatic way to generate corresponding python classes. These classes are then instantiated in the python interpreter to construct the control graph.</p>
<p>So in summary one can implement <b> fast complex controllers </b> with elementary blocks and <b> prototype it in Python </b>.</p>
<p>The C++ API contains C Macros that allows you to <b>define Commands very simply</b>. Signals are <b>automatically bounded</b> in Python.</p>
<h2><a class="anchor" id="intro_sec_dgm"></a>
1.4/ The dynamic_graph_manager</h2>
<div class="image">
<img src="dynamic_graph_manager_architecture.png" alt="dynamic_graph_manager_architecture.png"/>
<div class="caption">
Figure 4: This picture depicts the interaction between all the component of the robot controller.</div></div>
<p> A simple demo on how to implement such a DynamicGraphManager for one robot can be seen in the demo folder of the <a class="el" href="namespacedynamic__graph__manager.html" title="Example of hardware communication client based on ROS. ">dynamic_graph_manager</a> package. In theses files there are examples on the creation of the DynamicGraphManager daughter class, as well as the hardware asynchronous commands and the communication with the hardware.</p>
<p>More details on how things are running and implemented comes in the following pages.</p>
<h2><a class="anchor" id="intro_sec_structure"></a>
1.5/ Structure of the documentation</h2>
<p>The installation procedure for this package is available here: <a class="el" href="subpage_installation.html">2/ Installation Procedure</a></p>
<p>An example to launch can be found here: <a class="el" href="subpage_launch.html">3/ Start a Dynamic Graph Manager Executable</a></p>
<p>In general this package uses one yaml configuration file to define the robot properties. A good place to store such file is a robot_properties_[robot_name] pacakge. Such packages contain urdf models, meshes, configuration files, etc. And tutorial to create such package can be found here: <a class="el" href="subpage_robot_properties.html">4/ Implementing a robot in dynamic graph manager</a></p>
<p>This package uses the "dynamic graph" for the control. A simple example based on sot-core is available in here: <a class="el" href="subpage_basic_control_graph.html">5/ Basic Control Graph</a></p>
<p>This framework lives in the ROS eco-system. So it profits from the ROS community tools such as rqt_plot, rviz. In addition to these tools a plotting tools has been develop in order to evaluate data in a dynamic way. Exmaples of usage are available here: <a class="el" href="subpage_plot.html">5/ Oscilloscope / Plotting / Logging / Motor and control process timing</a></p>
<p>Debugging the current implementationa dn specifically the dynamic graph can be tedious because of the C++/Python interaction, the spawning of different processes, etc. Exmaples of debugging technics can be found here: <a class="el" href="subpage_debugging.html">6/ Debugging the implementation</a></p>
<p>In the following pages you will find how we interface the dynamic graph with a dynamical simulator: <a class="el" href="subpage_robot_simulation.html">7/ Interfacing with a robot simulator</a></p>
<p>As mention above this framework is part of the ROS eco-system. As such, the rqt framework is available. A specialization for the <a class="el" href="namespacedynamic__graph.html" title="this is this package namespace in order to avoid naming conflict ">dynamic_graph</a> is available as rqt_dynamic_graph. An example on how to create a robot dashboard using rqt is available here: <a class="el" href="subpage_robot_dashboard.html">8/ Robot dashboard</a></p>
<p>This page present the steps executed during the continuous integration build. <a class="el" href="subpage_ci.html">9/ Continuous integration</a></p>
<p>This page shows you how to run the demo in this package. <a class="el" href="subpage_demos.html">10/ Demos</a> </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
