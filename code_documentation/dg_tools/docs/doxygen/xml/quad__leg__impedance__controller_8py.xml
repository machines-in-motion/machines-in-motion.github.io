<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.11">
  <compounddef id="quad__leg__impedance__controller_8py" kind="file" language="Python">
    <compoundname>quad_leg_impedance_controller.py</compoundname>
    <innerclass refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedLegImpedanceController" prot="public">python::dg_tools::leg_impedance_control::quad_leg_impedance_controller::QuadrupedLegImpedanceController</innerclass>
    <innerclass refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl" prot="public">python::dg_tools::leg_impedance_control::quad_leg_impedance_controller::QuadrupedComControl</innerclass>
    <innernamespace refid="namespacepython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller">python::dg_tools::leg_impedance_control::quad_leg_impedance_controller</innernamespace>
    <innernamespace refid="namespacedg__blmc__robot">dg_blmc_robot</innernamespace>
    <briefdescription>
<para>Impedance controller implementation on a quadruped. </para>    </briefdescription>
    <detaileddescription>
<para><simplesect kind="author"><para>Avadesh Meduri </para></simplesect>
<xrefsect id="license_1_license000014"><xreftitle>License</xreftitle><xrefdescription><para>License BSD-3-Clause </para></xrefdescription></xrefsect><simplesect kind="copyright"><para>Copyright (c) 2019, New York University and Max Planck Gesellschaft. </para></simplesect>
<simplesect kind="date"><para>2019-03-01 </para></simplesect>
</para>    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="2"><highlight class="stringliteral">@package<sp/>dg_blmc_robot</highlight></codeline>
<codeline lineno="3"><highlight class="stringliteral">@file<sp/>quad_leg_impedance_controller.py</highlight></codeline>
<codeline lineno="4"><highlight class="stringliteral">@author<sp/>Avadesh<sp/>Meduri</highlight></codeline>
<codeline lineno="5"><highlight class="stringliteral">@license<sp/>License<sp/>BSD-3-Clause</highlight></codeline>
<codeline lineno="6"><highlight class="stringliteral">@copyright<sp/>Copyright<sp/>(c)<sp/>2019,<sp/>New<sp/>York<sp/>University<sp/>and<sp/>Max<sp/>Planck<sp/>Gesellschaft.</highlight></codeline>
<codeline lineno="7"><highlight class="stringliteral">@date<sp/>2019-03-01</highlight></codeline>
<codeline lineno="8"><highlight class="stringliteral">@brief<sp/>Impedance<sp/>controller<sp/>implementation<sp/>on<sp/>a<sp/>quadruped</highlight></codeline>
<codeline lineno="9"><highlight class="stringliteral">&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight><highlight class="comment">###########################<sp/>Imports<sp/>###########################################</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight></codeline>
<codeline lineno="13"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>dg_tools.utils<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>*</highlight></codeline>
<codeline lineno="14"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>dg_tools.traj_generators<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>mul_double_vec_2</highlight></codeline>
<codeline lineno="15"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>dg_tools.leg_impedance_control.leg_impedance_controller<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>LegImpedanceController</highlight></codeline>
<codeline lineno="16"><highlight class="normal"></highlight></codeline>
<codeline lineno="17"><highlight class="normal"></highlight><highlight class="comment">#<sp/>from<sp/>dynamic_graph_manager.vicon_sdk<sp/>import<sp/>ViconClientEntity</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="18"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>dynamic_graph_manager.dg_tools<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>ComImpedanceControl</highlight></codeline>
<codeline lineno="19"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>dynamic_graph.sot.core.switch<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>SwitchVector</highlight></codeline>
<codeline lineno="20"><highlight class="normal"></highlight></codeline>
<codeline lineno="21"><highlight class="normal"></highlight><highlight class="comment">###############################################################################</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="22"><highlight class="normal"></highlight></codeline>
<codeline lineno="23"><highlight class="normal"></highlight></codeline>
<codeline lineno="24" refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedLegImpedanceController" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedLegImpedanceController" kindref="compound">QuadrupedLegImpedanceController</ref>():</highlight></codeline>
<codeline lineno="25"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">__init__(self,<sp/>robot):</highlight></codeline>
<codeline lineno="26"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedLegImpedanceController_1ac27f3b4ad26d2fc0c23d73efaa3bffdb" kindref="member">robot</ref><sp/>=<sp/>robot</highlight></codeline>
<codeline lineno="27"><highlight class="normal"></highlight></codeline>
<codeline lineno="28"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedLegImpedanceController_1a099a3736c547979bb639de5def48a7d5" kindref="member">imp_ctrl_leg_fl</ref><sp/>=<sp/>LegImpedanceController(</highlight><highlight class="stringliteral">&quot;fl&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="29"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedLegImpedanceController_1a5fb205521b76d5a25dda5c1a3a912501" kindref="member">imp_ctrl_leg_fr</ref><sp/>=<sp/>LegImpedanceController(</highlight><highlight class="stringliteral">&quot;fr&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="30"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedLegImpedanceController_1a533c02f2d6ac458d6526712b153efdfd" kindref="member">imp_ctrl_leg_hl</ref><sp/>=<sp/>LegImpedanceController(</highlight><highlight class="stringliteral">&quot;hl&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="31"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedLegImpedanceController_1ad21bde4b52a2a2474b7fdb1b5f2b5cf1" kindref="member">imp_ctrl_leg_hr</ref><sp/>=<sp/>LegImpedanceController(</highlight><highlight class="stringliteral">&quot;hr&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="32"><highlight class="normal"></highlight></codeline>
<codeline lineno="33"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">return_control_torques(self,<sp/>kp,<sp/>des_pos,<sp/>kd=None,<sp/>des_vel=None,<sp/>kf<sp/>=<sp/>None,<sp/>fff=None):</highlight></codeline>
<codeline lineno="34"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="35"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Input<sp/>:<sp/>Kp<sp/>-<sp/>proportional<sp/>gain<sp/>(double)</highlight></codeline>
<codeline lineno="36"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:<sp/>des_pos<sp/>-<sp/>1*12<sp/>vector<sp/>of<sp/>desired_position<sp/>in<sp/>current<sp/>time<sp/>step<sp/>(size<sp/>:<sp/>1*24<sp/>)</highlight></codeline>
<codeline lineno="37"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:<sp/>Kd<sp/>-<sp/>derivative<sp/>gain<sp/>(double)</highlight></codeline>
<codeline lineno="38"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:<sp/>des_vel<sp/>-<sp/>1*12<sp/>vector<sp/>of<sp/>desired_velocity<sp/>in<sp/>current<sp/>time<sp/>step<sp/>(size<sp/>:<sp/>1*24)</highlight></codeline>
<codeline lineno="39"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:<sp/>fff<sp/>-<sp/>Feed<sp/>forward<sp/>force<sp/>(size<sp/>:<sp/>1*24)</highlight></codeline>
<codeline lineno="40"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="41"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedLegImpedanceController_1a0530f8803b7f7b59fe3d7a8dfcee45d8" kindref="member">joint_positions</ref><sp/>=<sp/>self.robot.device.signal(</highlight><highlight class="stringliteral">&quot;joint_positions&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="42"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedLegImpedanceController_1a6ffc1716a029c75c48c144650a4795fa" kindref="member">joint_velocities</ref><sp/>=<sp/>self.robot.device.signal(</highlight><highlight class="stringliteral">&quot;joint_velocities&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="43"><highlight class="normal"></highlight></codeline>
<codeline lineno="44"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">###<sp/>For<sp/>FL<sp/>#############################################################</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="45"><highlight class="normal"></highlight></codeline>
<codeline lineno="46"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>joint_positions_fl<sp/>=<sp/>selec_vector(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedLegImpedanceController_1a0530f8803b7f7b59fe3d7a8dfcee45d8" kindref="member">joint_positions</ref>,<sp/>0,<sp/>2,<sp/></highlight><highlight class="stringliteral">&apos;position_slicer_fl&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="47"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>joint_velocities_fl<sp/>=<sp/>selec_vector(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedLegImpedanceController_1a6ffc1716a029c75c48c144650a4795fa" kindref="member">joint_velocities</ref>,<sp/>0,<sp/>2,<sp/></highlight><highlight class="stringliteral">&apos;velocity_slicer_fl&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="48"><highlight class="normal"></highlight></codeline>
<codeline lineno="49"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(stack_zero((joint_positions_fl),</highlight><highlight class="stringliteral">&quot;add_base_joint_position_fl&quot;</highlight><highlight class="normal">),<sp/>self.imp_ctrl_leg_fl.robot_dg.position)</highlight></codeline>
<codeline lineno="50"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(stack_zero((joint_velocities_fl),<sp/></highlight><highlight class="stringliteral">&quot;add_base_joint_velocity_fl&quot;</highlight><highlight class="normal">),<sp/>self.imp_ctrl_leg_fl.robot_dg.velocity<sp/>)</highlight></codeline>
<codeline lineno="51"><highlight class="normal"></highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>des_pos_fl<sp/>=<sp/>selec_vector(des_pos,<sp/>0,<sp/>6,<sp/></highlight><highlight class="stringliteral">&apos;des_position_slicer_fl&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="53"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>des_vel<sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="54"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>des_vel_fl<sp/>=<sp/>selec_vector(des_vel,<sp/>0,<sp/>6,<sp/></highlight><highlight class="stringliteral">&apos;des_veolcity_slicer_fl&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="55"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="56"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>des_vel_fl<sp/>=<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="57"><highlight class="normal"></highlight></codeline>
<codeline lineno="58"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>fff<sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="59"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fff_fl<sp/>=<sp/>selec_vector(fff,<sp/>0,<sp/>6,<sp/></highlight><highlight class="stringliteral">&apos;fff_slicer_fl&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="60"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="61"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fff_fl<sp/>=<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="62"><highlight class="normal"></highlight></codeline>
<codeline lineno="63"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>control_torques_fl<sp/>=<sp/>self.imp_ctrl_leg_fl.return_control_torques(kp,<sp/>des_pos_fl,<sp/>kd,<sp/>des_vel_fl,<sp/>kf,<sp/>fff_fl)</highlight></codeline>
<codeline lineno="64"><highlight class="normal"></highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">##<sp/>For<sp/>FR<sp/>##############################################################</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="66"><highlight class="normal"></highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>joint_positions_fr<sp/>=<sp/>selec_vector(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedLegImpedanceController_1a0530f8803b7f7b59fe3d7a8dfcee45d8" kindref="member">joint_positions</ref>,<sp/>2,<sp/>4,<sp/></highlight><highlight class="stringliteral">&apos;position_slicer_fr&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>joint_velocities_fr<sp/>=<sp/>selec_vector(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedLegImpedanceController_1a6ffc1716a029c75c48c144650a4795fa" kindref="member">joint_velocities</ref>,<sp/>2,<sp/>4,<sp/></highlight><highlight class="stringliteral">&apos;velocity_slicer_fr&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="69"><highlight class="normal"></highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(stack_zero((joint_positions_fr),</highlight><highlight class="stringliteral">&quot;add_base_joint_position_fr&quot;</highlight><highlight class="normal">),<sp/>self.imp_ctrl_leg_fr.robot_dg.position)</highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(stack_zero((joint_velocities_fr),<sp/></highlight><highlight class="stringliteral">&quot;add_base_joint_velocity_fr&quot;</highlight><highlight class="normal">),<sp/>self.imp_ctrl_leg_fr.robot_dg.velocity<sp/>)</highlight></codeline>
<codeline lineno="72"><highlight class="normal"></highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>des_pos_fr<sp/>=<sp/>selec_vector(des_pos,<sp/>6,<sp/>12,<sp/></highlight><highlight class="stringliteral">&apos;des_position_slicer_fr&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>des_vel<sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>des_vel_fr<sp/>=<sp/>selec_vector(des_vel,<sp/>6,<sp/>12,<sp/></highlight><highlight class="stringliteral">&apos;des_veolcity_slicer_fr&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>des_vel_fr<sp/>=<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="78"><highlight class="normal"></highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>fff<sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fff_fr<sp/>=<sp/>selec_vector(fff,<sp/>6,<sp/>12,<sp/></highlight><highlight class="stringliteral">&apos;fff_slicer_fr&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="82"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fff_fr<sp/>=<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="83"><highlight class="normal"></highlight></codeline>
<codeline lineno="84"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>control_torques_fr<sp/>=<sp/>self.imp_ctrl_leg_fr.return_control_torques(kp,<sp/>des_pos_fr,<sp/>kd,<sp/>des_vel_fr,<sp/>kf,<sp/>fff_fr)</highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>control_torques_fr<sp/>=<sp/>zero_vec(2,<sp/>&quot;zero_torque_fr&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="86"><highlight class="normal"></highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">###<sp/>For<sp/>HL<sp/>#############################################################</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="88"><highlight class="normal"></highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>joint_positions_hl<sp/>=<sp/>selec_vector(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedLegImpedanceController_1a0530f8803b7f7b59fe3d7a8dfcee45d8" kindref="member">joint_positions</ref>,<sp/>4,<sp/>6,<sp/></highlight><highlight class="stringliteral">&apos;position_slicer_hl&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>joint_velocities_hl<sp/>=<sp/>selec_vector(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedLegImpedanceController_1a6ffc1716a029c75c48c144650a4795fa" kindref="member">joint_velocities</ref>,<sp/>4,<sp/>6,<sp/></highlight><highlight class="stringliteral">&apos;velocity_slicer_hl&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="91"><highlight class="normal"></highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(stack_zero((joint_positions_hl),</highlight><highlight class="stringliteral">&quot;add_base_joint_position_hl&quot;</highlight><highlight class="normal">),<sp/>self.imp_ctrl_leg_hl.robot_dg.position)</highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(stack_zero((joint_velocities_hl),<sp/></highlight><highlight class="stringliteral">&quot;add_base_joint_velocity_hl&quot;</highlight><highlight class="normal">),<sp/>self.imp_ctrl_leg_hl.robot_dg.velocity<sp/>)</highlight></codeline>
<codeline lineno="94"><highlight class="normal"></highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>des_pos_hl<sp/>=<sp/>selec_vector(des_pos,<sp/>12,<sp/>18,<sp/></highlight><highlight class="stringliteral">&apos;des_position_slicer_hl&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>des_vel<sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="97"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>des_vel_hl<sp/>=<sp/>selec_vector(des_vel,<sp/>12,<sp/>18,<sp/></highlight><highlight class="stringliteral">&apos;des_veolcity_slicer_hl&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>des_vel_hl<sp/>=<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="100"><highlight class="normal"></highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>fff<sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fff_hl<sp/>=<sp/>selec_vector(fff,<sp/>12,<sp/>18,<sp/></highlight><highlight class="stringliteral">&apos;fff_slicer_hl&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fff_hl<sp/>=<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="105"><highlight class="normal"></highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>control_torques_hl<sp/>=<sp/>self.imp_ctrl_leg_hl.return_control_torques(kp,<sp/>des_pos_hl,<sp/>kd,<sp/>des_vel_hl,<sp/>kf,<sp/>fff_hl)</highlight></codeline>
<codeline lineno="107"><highlight class="normal"></highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">##<sp/>For<sp/>HR<sp/>##############################################################</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="109"><highlight class="normal"></highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>joint_positions_hr<sp/>=<sp/>selec_vector(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedLegImpedanceController_1a0530f8803b7f7b59fe3d7a8dfcee45d8" kindref="member">joint_positions</ref>,<sp/>6,<sp/>8,<sp/></highlight><highlight class="stringliteral">&apos;position_slicer_hr&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>joint_velocities_hr<sp/>=<sp/>selec_vector(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedLegImpedanceController_1a6ffc1716a029c75c48c144650a4795fa" kindref="member">joint_velocities</ref>,<sp/>6,<sp/>8,<sp/></highlight><highlight class="stringliteral">&apos;velocity_slicer_hr&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="112"><highlight class="normal"></highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(stack_zero((joint_positions_hr),</highlight><highlight class="stringliteral">&quot;add_base_joint_position_hr&quot;</highlight><highlight class="normal">),<sp/>self.imp_ctrl_leg_hr.robot_dg.position)</highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(stack_zero((joint_velocities_hr),<sp/></highlight><highlight class="stringliteral">&quot;add_base_joint_velocity_hr&quot;</highlight><highlight class="normal">),<sp/>self.imp_ctrl_leg_hr.robot_dg.velocity<sp/>)</highlight></codeline>
<codeline lineno="115"><highlight class="normal"></highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>des_pos_hr<sp/>=<sp/>selec_vector(des_pos,<sp/>18,<sp/>24,<sp/></highlight><highlight class="stringliteral">&apos;des_position_slicer_hr&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>des_vel<sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>des_vel_hr<sp/>=<sp/>selec_vector(des_vel,<sp/>18,<sp/>24,<sp/></highlight><highlight class="stringliteral">&apos;des_veolcity_slicer_hr&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="120"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>des_vel_hr<sp/>=<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="121"><highlight class="normal"></highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>fff<sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fff_hr<sp/>=<sp/>selec_vector(fff,<sp/>18,<sp/>24,<sp/></highlight><highlight class="stringliteral">&apos;fff_slicer_hr&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fff_hr<sp/>=<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="126"><highlight class="normal"></highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>control_torques_hr<sp/>=<sp/>self.imp_ctrl_leg_hr.return_control_torques(kp,<sp/>des_pos_hr,<sp/>kd,<sp/>des_vel_hr,<sp/>kf,<sp/>fff_hr)</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>control_torques_hr<sp/>=<sp/>zero_vec(2,<sp/>&quot;zero_torque_hr&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="129"><highlight class="normal"></highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#######################<sp/>Stacking<sp/>torques<sp/>of<sp/>each<sp/>leg<sp/>into<sp/>one<sp/>vector<sp/>#####</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="131"><highlight class="normal"></highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>control_torques_fl_fr<sp/>=<sp/>stack_two_vectors(control_torques_fl,<sp/>control_torques_fr,<sp/>2,<sp/>2)</highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>control_torques_hl_hr<sp/>=<sp/>stack_two_vectors(control_torques_hl,<sp/>control_torques_hr,<sp/>2,<sp/>2)</highlight></codeline>
<codeline lineno="134"><highlight class="normal"></highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>control_torques<sp/>=<sp/>stack_two_vectors(control_torques_fl_fr,control_torques_hl_hr,<sp/>4,<sp/>4)</highlight></codeline>
<codeline lineno="136"><highlight class="normal"></highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>control_torques</highlight></codeline>
<codeline lineno="138"><highlight class="normal"></highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">return_joint_ctrl_torques(self,<sp/>kp_joint,<sp/>des_joint_pos,<sp/>kd_joint,<sp/>des_joint_vel):</highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pos_error<sp/>=<sp/>subtract_vec_vec(des_joint_pos,<sp/>self.robot.device.joint_positions,<sp/></highlight><highlight class="stringliteral">&quot;joint_pos_error&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>vel_error<sp/>=<sp/>subtract_vec_vec(des_joint_vel,<sp/>self.robot.device.joint_velocities,<sp/></highlight><highlight class="stringliteral">&quot;joint_vel_error&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mul_kp_gains<sp/>=<sp/>Multiply_of_vector(</highlight><highlight class="stringliteral">&quot;kp_joint&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(kp_joint,<sp/>mul_kp_gains.sin0)</highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(pos_error,<sp/>mul_kp_gains.sin1)</highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pos_error_with_gains<sp/>=<sp/>mul_kp_gains.sout</highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mul_kd_gains<sp/>=<sp/>Multiply_of_vector(</highlight><highlight class="stringliteral">&quot;kd_joint&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(kd_joint,<sp/>mul_kd_gains.sin0)</highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(vel_error,<sp/>mul_kd_gains.sin1)</highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>vel_error_with_gains<sp/>=<sp/>mul_kd_gains.sout</highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>jtorque<sp/>=<sp/>add_vec_vec(pos_error_with_gains,<sp/>vel_error_with_gains,<sp/></highlight><highlight class="stringliteral">&quot;joint_torque&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>jtorque</highlight></codeline>
<codeline lineno="152"><highlight class="normal"></highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">record_data(self,<sp/>record_vicon<sp/>=<sp/>False):</highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.imp_ctrl_leg_fl.record_data(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedLegImpedanceController_1ac27f3b4ad26d2fc0c23d73efaa3bffdb" kindref="member">robot</ref>)</highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.imp_ctrl_leg_fr.record_data(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedLegImpedanceController_1ac27f3b4ad26d2fc0c23d73efaa3bffdb" kindref="member">robot</ref>)</highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.imp_ctrl_leg_hl.record_data(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedLegImpedanceController_1ac27f3b4ad26d2fc0c23d73efaa3bffdb" kindref="member">robot</ref>)</highlight></codeline>
<codeline lineno="157"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.imp_ctrl_leg_hr.record_data(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedLegImpedanceController_1ac27f3b4ad26d2fc0c23d73efaa3bffdb" kindref="member">robot</ref>)</highlight></codeline>
<codeline lineno="158"><highlight class="normal"></highlight></codeline>
<codeline lineno="159"><highlight class="normal"></highlight></codeline>
<codeline lineno="160" refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl" kindref="compound">QuadrupedComControl</ref>(object):</highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a79f0bfd4d6bec7c6db16a92dfcbae34d" kindref="member">__init__</ref>(self,<sp/>robot,<sp/>ViconClientEntity=None,<sp/>client_name<sp/>=<sp/>&quot;vicon_client&quot;,</highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>vicon_ip<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;10.32.3.16:801&apos;</highlight><highlight class="normal">,<sp/>EntityName<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;quad_com_ctrl&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>base_position=</highlight><highlight class="keywordtype">None</highlight><highlight class="normal">,<sp/>base_velocity=</highlight><highlight class="keywordtype">None</highlight><highlight class="normal">):</highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="165"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Args:</highlight></codeline>
<codeline lineno="166"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>base_position:<sp/>(Optional,<sp/>Vec7d<sp/>signal)<sp/>Base<sp/>position<sp/>of<sp/>the<sp/>robot.</highlight></codeline>
<codeline lineno="167"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>base_velocity:<sp/>(Optional,<sp/>Vec6d<sp/>signal)<sp/>Base<sp/>velocity<sp/>of<sp/>the<sp/>robot.</highlight></codeline>
<codeline lineno="168"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a488eecc9d4462202d8bb53602927db9c" kindref="member">robot</ref><sp/>=<sp/>robot</highlight></codeline>
<codeline lineno="170"><highlight class="normal"></highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a82f0b7c3180f2f9715dd92708581a8de" kindref="member">EntityName</ref><sp/>=<sp/>EntityName</highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a24959d27c6da979857fa30013833441b" kindref="member">init_robot_properties</ref>()</highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a13da8028b3e77cf5a4d2fdaef725bffe" kindref="member">client_name</ref><sp/>=<sp/>client_name</highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1ade7b6029cb3100520e1aa478b4277019" kindref="member">host_name_quadruped</ref><sp/>=<sp/>vicon_ip</highlight></codeline>
<codeline lineno="175"><highlight class="normal"></highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>ViconClientEntity:</highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a98858d4caa17f4359c5acdea327c7ee3" kindref="member">vicon_client</ref><sp/>=<sp/>ViconClientEntity(</highlight><highlight class="stringliteral">&apos;vicon_&apos;</highlight><highlight class="normal"><sp/>+<sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a13da8028b3e77cf5a4d2fdaef725bffe" kindref="member">client_name</ref>)</highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.vicon_client.connect_to_vicon(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1ade7b6029cb3100520e1aa478b4277019" kindref="member">host_name_quadruped</ref>)</highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.vicon_client.displaySignals()</highlight></codeline>
<codeline lineno="180"><highlight class="normal"></highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.vicon_client.add_object_to_track(</highlight><highlight class="stringliteral">&quot;{}/{}&quot;</highlight><highlight class="normal">.format(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a4f07757912f99abaea2a60467583caff" kindref="member">robot_vicon_name</ref>,<sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a4f07757912f99abaea2a60467583caff" kindref="member">robot_vicon_name</ref>))</highlight></codeline>
<codeline lineno="182"><highlight class="normal"></highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">##<sp/>comment<sp/>out<sp/>if<sp/>running<sp/>on<sp/>real<sp/>robot</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.vicon_client.robot_wrapper(robot,<sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a4f07757912f99abaea2a60467583caff" kindref="member">robot_vicon_name</ref>)</highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>print(</highlight><highlight class="stringliteral">&quot;not<sp/>in<sp/>simulation&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="188"><highlight class="normal"></highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.robot.add_trace(self.vicon_client.name,<sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a4f07757912f99abaea2a60467583caff" kindref="member">robot_vicon_name</ref><sp/>+<sp/></highlight><highlight class="stringliteral">&quot;_position&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.robot.add_trace(self.vicon_client.name,<sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a4f07757912f99abaea2a60467583caff" kindref="member">robot_vicon_name</ref><sp/>+<sp/></highlight><highlight class="stringliteral">&quot;_velocity_body&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.robot.add_trace(self.vicon_client.name,<sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a4f07757912f99abaea2a60467583caff" kindref="member">robot_vicon_name</ref><sp/>+<sp/></highlight><highlight class="stringliteral">&quot;_velocity_world&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a695c53b1d3f3048db84a33a2d028d2d2" kindref="member">vicon_base_position</ref><sp/>=<sp/>self.vicon_client.signal(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a4f07757912f99abaea2a60467583caff" kindref="member">robot_vicon_name</ref><sp/>+<sp/></highlight><highlight class="stringliteral">&quot;_position&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a1c6239d0a6491040ef0b7d71acc5e1e8" kindref="member">vicon_base_velocity</ref><sp/>=<sp/>self.vicon_client.signal(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a4f07757912f99abaea2a60467583caff" kindref="member">robot_vicon_name</ref><sp/>+<sp/></highlight><highlight class="stringliteral">&quot;_velocity_body&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">elif</highlight><highlight class="normal"><sp/>base_position<sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"><sp/>base_velocity:</highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a695c53b1d3f3048db84a33a2d028d2d2" kindref="member">vicon_base_position</ref><sp/>=<sp/>base_position</highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a1c6239d0a6491040ef0b7d71acc5e1e8" kindref="member">vicon_base_velocity</ref><sp/>=<sp/>base_velocity</highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/>ValueError(</highlight><highlight class="stringliteral">&apos;Need<sp/>to<sp/>provide<sp/>either<sp/>ViconClientEntity<sp/>or<sp/>(base_positon<sp/>and<sp/>base_velocity)&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="199"><highlight class="normal"></highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a28ca164b0b8abfdd0f451a8953a737e9" kindref="member">com_imp_ctrl</ref><sp/>=<sp/>ComImpedanceControl(EntityName)</highlight></codeline>
<codeline lineno="201"><highlight class="normal"></highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1af39670c39353751a4b619aaa750db486" kindref="member">_biased_base_position</ref><sp/>=<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a45789c40361ce8f788984be0ee845c97" kindref="member">_biased_base_velocity</ref><sp/>=<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="204"><highlight class="normal"></highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a6f4dfb8c993ea388b065b9eb6abcef03" kindref="member">vicon_offset</ref><sp/>=<sp/>constVector([0.,<sp/>0.,<sp/>0.,])</highlight></codeline>
<codeline lineno="206"><highlight class="normal"></highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">init_robot_properties(self):</highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a4f07757912f99abaea2a60467583caff" kindref="member">robot_vicon_name</ref><sp/>=<sp/></highlight><highlight class="stringliteral">&quot;quadruped&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a87d507ec32ac2a6901ae04b827376569" kindref="member">robot_mass</ref><sp/>=<sp/>[2.17784,<sp/>2.17784,<sp/>2.17784]</highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a3786caaa2be0b24a5347adeca6bb952f" kindref="member">robot_base_inertia</ref><sp/>=<sp/>[0.00578574,<sp/>0.01938108,<sp/>0.02476124]</highlight></codeline>
<codeline lineno="211"><highlight class="normal"></highlight></codeline>
<codeline lineno="212"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">compute_torques(self,<sp/>Kp,<sp/>des_pos,<sp/>Kd,<sp/>des_vel,<sp/>des_fff):</highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1aac090bcc93ca706025c8b57d8f8e0042" kindref="member">base_pos_xyz</ref><sp/>=<sp/><sp/>add_vec_vec(</highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>selec_vector(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a695c53b1d3f3048db84a33a2d028d2d2" kindref="member">vicon_base_position</ref>,<sp/>0,<sp/>3,<sp/></highlight><highlight class="stringliteral">&quot;base_pos&quot;</highlight><highlight class="normal">),<sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a6f4dfb8c993ea388b065b9eb6abcef03" kindref="member">vicon_offset</ref>)</highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1abd3dafeed32eb38408f8fd0e9977b923" kindref="member">base_vel_xyz</ref><sp/>=<sp/>selec_vector(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a1c6239d0a6491040ef0b7d71acc5e1e8" kindref="member">vicon_base_velocity</ref>,<sp/>0,<sp/>3,<sp/></highlight><highlight class="stringliteral">&quot;base_vel&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="216"><highlight class="normal"></highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1aac090bcc93ca706025c8b57d8f8e0042" kindref="member">base_pos_xyz</ref>,<sp/>self.com_imp_ctrl.position)</highlight></codeline>
<codeline lineno="218"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1abd3dafeed32eb38408f8fd0e9977b923" kindref="member">base_vel_xyz</ref>,<sp/>self.com_imp_ctrl.velocity)</highlight></codeline>
<codeline lineno="219"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>plug(self.base_ang_vel_xyz,<sp/>self.com_imp_ctrl.angvel)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="220"><highlight class="normal"></highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(Kp,<sp/>self.com_imp_ctrl.Kp)</highlight></codeline>
<codeline lineno="222"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(Kd,<sp/>self.com_imp_ctrl.Kd)</highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(des_pos,<sp/>self.com_imp_ctrl.des_pos)</highlight></codeline>
<codeline lineno="224"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(des_vel,<sp/>self.com_imp_ctrl.des_vel)</highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(des_fff,<sp/>self.com_imp_ctrl.des_fff)</highlight></codeline>
<codeline lineno="226"><highlight class="normal"></highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">###<sp/>mass<sp/>in<sp/>all<sp/>direction<sp/>(double<sp/>to<sp/>vec<sp/>returns<sp/>zero)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">##<sp/>TODO<sp/>:<sp/>Check<sp/>if<sp/>there<sp/>is<sp/>dynamicgraph::double</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.com_imp_ctrl.mass.value<sp/>=<sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a87d507ec32ac2a6901ae04b827376569" kindref="member">robot_mass</ref></highlight></codeline>
<codeline lineno="230"><highlight class="normal"></highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a8e10de9b174c7e0d0a4e02c90697ca32" kindref="member">control_switch_pos</ref><sp/>=<sp/>SwitchVector(</highlight><highlight class="stringliteral">&quot;control_switch_pos&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.control_switch_pos.setSignalNumber(2)<sp/></highlight><highlight class="comment">#<sp/>we<sp/>want<sp/>to<sp/>switch<sp/>between<sp/>2<sp/>signals</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(zero_vec(3,</highlight><highlight class="stringliteral">&quot;zero_pos&quot;</highlight><highlight class="normal">),<sp/>self.control_switch_pos.sin0)</highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(self.com_imp_ctrl.set_pos_bias,<sp/>self.control_switch_pos.sin1)</highlight></codeline>
<codeline lineno="235"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.control_switch_pos.selection.value<sp/>=<sp/>0</highlight></codeline>
<codeline lineno="236"><highlight class="normal"></highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a78d353fbc468b24675b1c49fe9c12c2e" kindref="member">control_switch_vel</ref><sp/>=<sp/>SwitchVector(</highlight><highlight class="stringliteral">&quot;control_switch_vel&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.control_switch_vel.setSignalNumber(2)<sp/></highlight><highlight class="comment">#<sp/>we<sp/>want<sp/>to<sp/>switch<sp/>between<sp/>2<sp/>signals</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(zero_vec(3,</highlight><highlight class="stringliteral">&quot;zero_vel&quot;</highlight><highlight class="normal">),<sp/>self.control_switch_vel.sin0)</highlight></codeline>
<codeline lineno="240"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(self.com_imp_ctrl.set_vel_bias,<sp/>self.control_switch_vel.sin1)</highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(self.control_switch_pos.selection,<sp/>self.control_switch_vel.selection<sp/>)</highlight></codeline>
<codeline lineno="242"><highlight class="normal"></highlight></codeline>
<codeline lineno="243"><highlight class="normal"></highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a3e8ac246a42a33475e381d2a1e1f338d" kindref="member">biased_base_pos_xyz</ref><sp/>=<sp/>subtract_vec_vec(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1aac090bcc93ca706025c8b57d8f8e0042" kindref="member">base_pos_xyz</ref>,</highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.control_switch_pos.sout,<sp/></highlight><highlight class="stringliteral">&quot;biased_pos&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a0dc4bd5452d58aea5234d5a190a4d4c7" kindref="member">biased_base_vel_xyz</ref><sp/>=<sp/>subtract_vec_vec(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1abd3dafeed32eb38408f8fd0e9977b923" kindref="member">base_vel_xyz</ref>,</highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.control_switch_vel.sout,<sp/></highlight><highlight class="stringliteral">&quot;biased_vel&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="248"><highlight class="normal"></highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a3e8ac246a42a33475e381d2a1e1f338d" kindref="member">biased_base_pos_xyz</ref>,<sp/>self.com_imp_ctrl.biased_pos)</highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a0dc4bd5452d58aea5234d5a190a4d4c7" kindref="member">biased_base_vel_xyz</ref>,<sp/>self.com_imp_ctrl.biased_vel)</highlight></codeline>
<codeline lineno="251"><highlight class="normal"></highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a105e881a685bbb0e83a2a19d3fbd8e6f" kindref="member">torques</ref><sp/>=<sp/>self.com_imp_ctrl.tau</highlight></codeline>
<codeline lineno="253"><highlight class="normal"></highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a105e881a685bbb0e83a2a19d3fbd8e6f" kindref="member">torques</ref></highlight></codeline>
<codeline lineno="255"><highlight class="normal"></highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1abb466e86a2c54b0c3d0aebe6142dbc4b" kindref="member">compute_ang_control_torques</ref>(self,<sp/>Kp_ang,<sp/>des_ori,<sp/>Kd_ang,<sp/>des_ang_vel,<sp/>des_fft):</highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="258"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>###<sp/>Computes<sp/>torques<sp/>required<sp/>to<sp/>control<sp/>the<sp/>orientation<sp/>of<sp/>base</highlight></codeline>
<codeline lineno="259"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a6c1e1b68c68c6531b920c79ce5a42806" kindref="member">base_orientation</ref><sp/>=<sp/>selec_vector(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a695c53b1d3f3048db84a33a2d028d2d2" kindref="member">vicon_base_position</ref>,<sp/>3,<sp/>7,<sp/></highlight><highlight class="stringliteral">&quot;base_orientation&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a6b8a3f691df20c4ea6020c2dc6e30d82" kindref="member">base_ang_vel_xyz</ref><sp/>=<sp/>selec_vector(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a1c6239d0a6491040ef0b7d71acc5e1e8" kindref="member">vicon_base_velocity</ref>,<sp/>3,<sp/>6,<sp/></highlight><highlight class="stringliteral">&quot;selec_ang_dxyz&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="262"><highlight class="normal"></highlight></codeline>
<codeline lineno="263"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(Kp_ang,<sp/>self.com_imp_ctrl.Kp_ang)</highlight></codeline>
<codeline lineno="264"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(Kd_ang,<sp/>self.com_imp_ctrl.Kd_ang)</highlight></codeline>
<codeline lineno="265"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.com_imp_ctrl.inertia.value<sp/>=<sp/>[0.00578574,<sp/>0.01938108,<sp/>0.02476124]</highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a6c1e1b68c68c6531b920c79ce5a42806" kindref="member">base_orientation</ref>,<sp/>self.com_imp_ctrl.ori)</highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a6b8a3f691df20c4ea6020c2dc6e30d82" kindref="member">base_ang_vel_xyz</ref>,<sp/>self.com_imp_ctrl.angvel)</highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(des_ori,<sp/>self.com_imp_ctrl.des_ori)</highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(des_ang_vel,<sp/>self.com_imp_ctrl.des_ang_vel)</highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(des_fft,<sp/>self.com_imp_ctrl.des_fft)</highlight></codeline>
<codeline lineno="271"><highlight class="normal"></highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>self.com_imp_ctrl.angtau</highlight></codeline>
<codeline lineno="273"><highlight class="normal"></highlight></codeline>
<codeline lineno="274"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">set_bias(self):</highlight></codeline>
<codeline lineno="275"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.control_switch_pos.selection.value<sp/>=<sp/>1</highlight></codeline>
<codeline lineno="276"><highlight class="normal"></highlight></codeline>
<codeline lineno="277"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a471495c1adac63c6cb9a521fea0b52d6" kindref="member">get_biased_base_position</ref>(self):</highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="279"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Return<sp/>the<sp/>robot<sp/>position<sp/>taking<sp/>the<sp/>bias<sp/>offset<sp/>into<sp/>account.</highlight></codeline>
<codeline lineno="280"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="281"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Returns:</highlight></codeline>
<codeline lineno="282"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Signal&lt;dg::vector&gt;<sp/>of<sp/>size<sp/>7<sp/>(0:3<sp/>translation,<sp/>3:7<sp/>quaternion<sp/>orientation)</highlight></codeline>
<codeline lineno="283"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="284"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1af39670c39353751a4b619aaa750db486" kindref="member">_biased_base_position</ref><sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="285"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1af39670c39353751a4b619aaa750db486" kindref="member">_biased_base_position</ref><sp/>=<sp/>stack_two_vectors(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a3e8ac246a42a33475e381d2a1e1f338d" kindref="member">biased_base_pos_xyz</ref>,</highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a6c1e1b68c68c6531b920c79ce5a42806" kindref="member">base_orientation</ref>,<sp/>3,<sp/>4,<sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a82f0b7c3180f2f9715dd92708581a8de" kindref="member">EntityName</ref><sp/>+<sp/></highlight><highlight class="stringliteral">&apos;_biased_base_pos&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="287"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1af39670c39353751a4b619aaa750db486" kindref="member">_biased_base_position</ref></highlight></codeline>
<codeline lineno="288"><highlight class="normal"></highlight></codeline>
<codeline lineno="289"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1af130be175b4257723b48248e1ec41ab4" kindref="member">get_biased_base_velocity</ref>(self):</highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="291"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Return<sp/>the<sp/>robot<sp/>velocity<sp/>taking<sp/>the<sp/>bias<sp/>offset<sp/>into<sp/>account.</highlight></codeline>
<codeline lineno="292"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="293"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Returns:</highlight></codeline>
<codeline lineno="294"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Signal&lt;dg::vector&gt;<sp/>of<sp/>size<sp/>6<sp/>(0:3<sp/>translation,<sp/>3:6<sp/>rpy<sp/>orientation)</highlight></codeline>
<codeline lineno="295"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="296"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a45789c40361ce8f788984be0ee845c97" kindref="member">_biased_base_velocity</ref><sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="297"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a45789c40361ce8f788984be0ee845c97" kindref="member">_biased_base_velocity</ref><sp/>=<sp/>stack_two_vectors(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a0dc4bd5452d58aea5234d5a190a4d4c7" kindref="member">biased_base_vel_xyz</ref>,</highlight></codeline>
<codeline lineno="298"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a6b8a3f691df20c4ea6020c2dc6e30d82" kindref="member">base_ang_vel_xyz</ref>,<sp/>3,<sp/>3,<sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a82f0b7c3180f2f9715dd92708581a8de" kindref="member">EntityName</ref><sp/>+<sp/></highlight><highlight class="stringliteral">&apos;_biased_base_vel&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="299"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a45789c40361ce8f788984be0ee845c97" kindref="member">_biased_base_velocity</ref></highlight></codeline>
<codeline lineno="300"><highlight class="normal"></highlight></codeline>
<codeline lineno="301"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">set_abs_end_eff_pos(self,<sp/>abs_end_eff_pos_sig):</highlight></codeline>
<codeline lineno="302"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(abs_end_eff_pos_sig,<sp/>self.com_imp_ctrl.abs_end_eff_pos)</highlight></codeline>
<codeline lineno="303"><highlight class="normal"></highlight></codeline>
<codeline lineno="304"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">threshold_cnt_sensor(self):</highlight></codeline>
<codeline lineno="305"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(self.robot.device.contact_sensors,<sp/>self.com_imp_ctrl.cnt_sensor)</highlight></codeline>
<codeline lineno="306"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>self.com_imp_ctrl.thr_cnt_sensor</highlight></codeline>
<codeline lineno="307"><highlight class="normal"></highlight></codeline>
<codeline lineno="308"><highlight class="normal"></highlight></codeline>
<codeline lineno="309"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">convert_cnt_value_to_3d(self,<sp/>cnt_sensor,<sp/>start_index,<sp/>end_index,<sp/>entityName):</highlight></codeline>
<codeline lineno="310"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">##<sp/>Converts<sp/>each<sp/>element<sp/>of<sp/>contact<sp/>sensor<sp/>to<sp/>3d<sp/>to<sp/>allow<sp/>vec_vec<sp/>multiplication</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="311"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>selec_cnt_value<sp/>=<sp/>selec_vector(cnt_sensor,<sp/>start_index,<sp/>end_index,<sp/>entityName)</highlight></codeline>
<codeline lineno="312"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cnt_value_2d<sp/>=<sp/>stack_two_vectors(selec_cnt_value,<sp/>selec_cnt_value,<sp/>1,<sp/>1)</highlight></codeline>
<codeline lineno="313"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cnt_value_3d<sp/>=<sp/>stack_two_vectors(cnt_value_2d,<sp/>selec_cnt_value,<sp/>2,<sp/>1)</highlight></codeline>
<codeline lineno="314"><highlight class="normal"></highlight></codeline>
<codeline lineno="315"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>cnt_value_3d</highlight></codeline>
<codeline lineno="316"><highlight class="normal"></highlight></codeline>
<codeline lineno="317"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a7b2d46aa0abd8e9ced9e3cce2147d124" kindref="member">return_lqr_tau</ref>(self,des_pos,<sp/>des_vel,<sp/>des_ori,<sp/>des_ang_vel,<sp/>des_fff,<sp/>des_fft,<sp/>des_lqr):</highlight></codeline>
<codeline lineno="318"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="319"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>###<sp/>for<sp/>lqr<sp/>based<sp/>controller.<sp/>reads<sp/>values<sp/>obtained<sp/>from<sp/>the<sp/>planner</highlight></codeline>
<codeline lineno="320"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="321"><highlight class="normal"></highlight></codeline>
<codeline lineno="322"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1aac090bcc93ca706025c8b57d8f8e0042" kindref="member">base_pos_xyz</ref><sp/>=<sp/>selec_vector(self.vicon_client.signal(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a4f07757912f99abaea2a60467583caff" kindref="member">robot_vicon_name</ref><sp/>+<sp/></highlight><highlight class="stringliteral">&quot;_position&quot;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="323"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0,<sp/>3,<sp/></highlight><highlight class="stringliteral">&quot;base_pos&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="324"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1abd3dafeed32eb38408f8fd0e9977b923" kindref="member">base_vel_xyz</ref><sp/>=<sp/>selec_vector(self.vicon_client.signal(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a4f07757912f99abaea2a60467583caff" kindref="member">robot_vicon_name</ref><sp/>+<sp/></highlight><highlight class="stringliteral">&quot;_velocity_body&quot;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="325"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0,<sp/>3,<sp/></highlight><highlight class="stringliteral">&quot;base_vel&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="326"><highlight class="normal"></highlight></codeline>
<codeline lineno="327"><highlight class="normal"></highlight></codeline>
<codeline lineno="328"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1aac090bcc93ca706025c8b57d8f8e0042" kindref="member">base_pos_xyz</ref>,<sp/>self.com_imp_ctrl.position)</highlight></codeline>
<codeline lineno="329"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1abd3dafeed32eb38408f8fd0e9977b923" kindref="member">base_vel_xyz</ref>,<sp/>self.com_imp_ctrl.velocity)</highlight></codeline>
<codeline lineno="330"><highlight class="normal"></highlight></codeline>
<codeline lineno="331"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a8e10de9b174c7e0d0a4e02c90697ca32" kindref="member">control_switch_pos</ref><sp/>=<sp/>SwitchVector(</highlight><highlight class="stringliteral">&quot;control_switch_pos&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="332"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.control_switch_pos.setSignalNumber(2)<sp/></highlight><highlight class="comment">#<sp/>we<sp/>want<sp/>to<sp/>switch<sp/>between<sp/>2<sp/>signals</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="333"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(zero_vec(3,</highlight><highlight class="stringliteral">&quot;zero_pos&quot;</highlight><highlight class="normal">),<sp/>self.control_switch_pos.sin0)</highlight></codeline>
<codeline lineno="334"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(self.com_imp_ctrl.set_pos_bias,<sp/>self.control_switch_pos.sin1)</highlight></codeline>
<codeline lineno="335"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.control_switch_pos.selection.value<sp/>=<sp/>0</highlight></codeline>
<codeline lineno="336"><highlight class="normal"></highlight></codeline>
<codeline lineno="337"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a78d353fbc468b24675b1c49fe9c12c2e" kindref="member">control_switch_vel</ref><sp/>=<sp/>SwitchVector(</highlight><highlight class="stringliteral">&quot;control_switch_vel&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="338"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.control_switch_vel.setSignalNumber(2)<sp/></highlight><highlight class="comment">#<sp/>we<sp/>want<sp/>to<sp/>switch<sp/>between<sp/>2<sp/>signals</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="339"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(zero_vec(3,</highlight><highlight class="stringliteral">&quot;zero_vel&quot;</highlight><highlight class="normal">),<sp/>self.control_switch_vel.sin0)</highlight></codeline>
<codeline lineno="340"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(self.com_imp_ctrl.set_vel_bias,<sp/>self.control_switch_vel.sin1)</highlight></codeline>
<codeline lineno="341"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(self.control_switch_pos.selection,<sp/>self.control_switch_vel.selection<sp/>)</highlight></codeline>
<codeline lineno="342"><highlight class="normal"></highlight></codeline>
<codeline lineno="343"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a6c1e1b68c68c6531b920c79ce5a42806" kindref="member">base_orientation</ref><sp/>=<sp/>selec_vector(self.vicon_client.signal(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a4f07757912f99abaea2a60467583caff" kindref="member">robot_vicon_name</ref></highlight></codeline>
<codeline lineno="344"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>+<sp/></highlight><highlight class="stringliteral">&quot;_position&quot;</highlight><highlight class="normal">),<sp/>3,7,<sp/></highlight><highlight class="stringliteral">&quot;base_orientation&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="345"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a3e8ac246a42a33475e381d2a1e1f338d" kindref="member">biased_base_pos_xyz</ref><sp/>=<sp/>subtract_vec_vec(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1aac090bcc93ca706025c8b57d8f8e0042" kindref="member">base_pos_xyz</ref>,</highlight></codeline>
<codeline lineno="346"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.control_switch_pos.sout,<sp/></highlight><highlight class="stringliteral">&quot;biased_pos&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="347"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a0dc4bd5452d58aea5234d5a190a4d4c7" kindref="member">biased_base_vel_xyz</ref><sp/>=<sp/>subtract_vec_vec(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1abd3dafeed32eb38408f8fd0e9977b923" kindref="member">base_vel_xyz</ref>,</highlight></codeline>
<codeline lineno="348"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.control_switch_vel.sout,<sp/></highlight><highlight class="stringliteral">&quot;biased_vel&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="349"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a6b8a3f691df20c4ea6020c2dc6e30d82" kindref="member">base_ang_vel_xyz</ref><sp/>=<sp/><sp/>selec_vector(self.vicon_client.signal(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a4f07757912f99abaea2a60467583caff" kindref="member">robot_vicon_name</ref></highlight></codeline>
<codeline lineno="350"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>+<sp/></highlight><highlight class="stringliteral">&quot;_velocity_body&quot;</highlight><highlight class="normal">),3,<sp/>6,<sp/></highlight><highlight class="stringliteral">&quot;selec_ang_dxyz&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="351"><highlight class="normal"></highlight></codeline>
<codeline lineno="352"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">####<sp/>LQR<sp/>equation:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="353"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">###should<sp/>be<sp/>removed</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="354"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(constVector([0.0,<sp/>0.0,<sp/>0.0],<sp/></highlight><highlight class="stringliteral">&quot;Kp_ang&quot;</highlight><highlight class="normal">),<sp/>self.com_imp_ctrl.Kp)</highlight></codeline>
<codeline lineno="355"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(constVector([0.0,<sp/>0.0,<sp/>0.0],<sp/></highlight><highlight class="stringliteral">&quot;Kp_ang&quot;</highlight><highlight class="normal">),<sp/>self.com_imp_ctrl.Kd)</highlight></codeline>
<codeline lineno="356"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(constVector([0.0,<sp/>0.0,<sp/>0.0],<sp/></highlight><highlight class="stringliteral">&quot;Kp_ang&quot;</highlight><highlight class="normal">),<sp/>self.com_imp_ctrl.Kp_ang)</highlight></codeline>
<codeline lineno="357"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(constVector([0.0,<sp/>0.0,<sp/>0.0],<sp/></highlight><highlight class="stringliteral">&quot;Kp_ang&quot;</highlight><highlight class="normal">),<sp/>self.com_imp_ctrl.Kd_ang)</highlight></codeline>
<codeline lineno="358"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(constVector([0.0,<sp/>0.0,<sp/>0.0],<sp/></highlight><highlight class="stringliteral">&quot;Kp_ang&quot;</highlight><highlight class="normal">),<sp/>self.com_imp_ctrl.inertia)</highlight></codeline>
<codeline lineno="359"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(constVector([0.0,<sp/>0.0,<sp/>0.0],<sp/></highlight><highlight class="stringliteral">&quot;Kp_ang&quot;</highlight><highlight class="normal">),<sp/>self.com_imp_ctrl.mass)</highlight></codeline>
<codeline lineno="360"><highlight class="normal"></highlight></codeline>
<codeline lineno="361"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">###</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="362"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(des_lqr,<sp/>self.com_imp_ctrl.lqr_gain)</highlight></codeline>
<codeline lineno="363"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a3e8ac246a42a33475e381d2a1e1f338d" kindref="member">biased_base_pos_xyz</ref>,<sp/>self.com_imp_ctrl.biased_pos)</highlight></codeline>
<codeline lineno="364"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(des_pos,<sp/>self.com_imp_ctrl.des_pos)</highlight></codeline>
<codeline lineno="365"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a0dc4bd5452d58aea5234d5a190a4d4c7" kindref="member">biased_base_vel_xyz</ref>,<sp/>self.com_imp_ctrl.biased_vel)</highlight></codeline>
<codeline lineno="366"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(des_vel,<sp/>self.com_imp_ctrl.des_vel)</highlight></codeline>
<codeline lineno="367"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(des_fff,<sp/>self.com_imp_ctrl.des_fff)</highlight></codeline>
<codeline lineno="368"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a6c1e1b68c68c6531b920c79ce5a42806" kindref="member">base_orientation</ref>,<sp/>self.com_imp_ctrl.ori)</highlight></codeline>
<codeline lineno="369"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a6b8a3f691df20c4ea6020c2dc6e30d82" kindref="member">base_ang_vel_xyz</ref>,<sp/>self.com_imp_ctrl.angvel)</highlight></codeline>
<codeline lineno="370"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(des_ori,<sp/>self.com_imp_ctrl.des_ori)</highlight></codeline>
<codeline lineno="371"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(des_ang_vel,<sp/>self.com_imp_ctrl.des_ang_vel)</highlight></codeline>
<codeline lineno="372"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(des_fft,<sp/>self.com_imp_ctrl.des_fft)</highlight></codeline>
<codeline lineno="373"><highlight class="normal"></highlight></codeline>
<codeline lineno="374"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>lqr_com_force<sp/>=<sp/>self.com_imp_ctrl.lqrtau</highlight></codeline>
<codeline lineno="375"><highlight class="normal"></highlight></codeline>
<codeline lineno="376"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>lqr_com_force</highlight></codeline>
<codeline lineno="377"><highlight class="normal"></highlight></codeline>
<codeline lineno="378"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a68a8b7ea897a69259d9409e0f703b7d3" kindref="member">return_end_eff_lqr_tau</ref>(self,<sp/>des_pos,<sp/>des_vel,<sp/>des_ori,<sp/>des_ang_vel,<sp/>des_fff,<sp/>des_lqr<sp/>):</highlight></codeline>
<codeline lineno="379"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="380"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>###<sp/>for<sp/>lqr<sp/>based<sp/>controller<sp/>at<sp/>the<sp/>end<sp/>effector.<sp/>reads<sp/>values<sp/>obtained<sp/>from<sp/>the<sp/>planner</highlight></codeline>
<codeline lineno="381"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="382"><highlight class="normal"></highlight></codeline>
<codeline lineno="383"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1aac090bcc93ca706025c8b57d8f8e0042" kindref="member">base_pos_xyz</ref><sp/>=<sp/>selec_vector(self.vicon_client.signal(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a4f07757912f99abaea2a60467583caff" kindref="member">robot_vicon_name</ref><sp/>+<sp/></highlight><highlight class="stringliteral">&quot;_position&quot;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="384"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0,<sp/>3,<sp/></highlight><highlight class="stringliteral">&quot;base_pos&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="385"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1abd3dafeed32eb38408f8fd0e9977b923" kindref="member">base_vel_xyz</ref><sp/>=<sp/>selec_vector(self.vicon_client.signal(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a4f07757912f99abaea2a60467583caff" kindref="member">robot_vicon_name</ref><sp/>+<sp/></highlight><highlight class="stringliteral">&quot;_velocity_body&quot;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="386"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0,<sp/>3,<sp/></highlight><highlight class="stringliteral">&quot;base_vel&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="387"><highlight class="normal"></highlight></codeline>
<codeline lineno="388"><highlight class="normal"></highlight></codeline>
<codeline lineno="389"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1aac090bcc93ca706025c8b57d8f8e0042" kindref="member">base_pos_xyz</ref>,<sp/>self.com_imp_ctrl.position)</highlight></codeline>
<codeline lineno="390"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1abd3dafeed32eb38408f8fd0e9977b923" kindref="member">base_vel_xyz</ref>,<sp/>self.com_imp_ctrl.velocity)</highlight></codeline>
<codeline lineno="391"><highlight class="normal"></highlight></codeline>
<codeline lineno="392"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a8e10de9b174c7e0d0a4e02c90697ca32" kindref="member">control_switch_pos</ref><sp/>=<sp/>SwitchVector(</highlight><highlight class="stringliteral">&quot;control_switch_pos&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="393"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.control_switch_pos.setSignalNumber(2)<sp/></highlight><highlight class="comment">#<sp/>we<sp/>want<sp/>to<sp/>switch<sp/>between<sp/>2<sp/>signals</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="394"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(zero_vec(3,</highlight><highlight class="stringliteral">&quot;zero_pos&quot;</highlight><highlight class="normal">),<sp/>self.control_switch_pos.sin0)</highlight></codeline>
<codeline lineno="395"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(self.com_imp_ctrl.set_pos_bias,<sp/>self.control_switch_pos.sin1)</highlight></codeline>
<codeline lineno="396"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.control_switch_pos.selection.value<sp/>=<sp/>0</highlight></codeline>
<codeline lineno="397"><highlight class="normal"></highlight></codeline>
<codeline lineno="398"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a78d353fbc468b24675b1c49fe9c12c2e" kindref="member">control_switch_vel</ref><sp/>=<sp/>SwitchVector(</highlight><highlight class="stringliteral">&quot;control_switch_vel&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="399"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.control_switch_vel.setSignalNumber(2)<sp/></highlight><highlight class="comment">#<sp/>we<sp/>want<sp/>to<sp/>switch<sp/>between<sp/>2<sp/>signals</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="400"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(zero_vec(3,</highlight><highlight class="stringliteral">&quot;zero_vel&quot;</highlight><highlight class="normal">),<sp/>self.control_switch_vel.sin0)</highlight></codeline>
<codeline lineno="401"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(self.com_imp_ctrl.set_vel_bias,<sp/>self.control_switch_vel.sin1)</highlight></codeline>
<codeline lineno="402"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(self.control_switch_pos.selection,<sp/>self.control_switch_vel.selection<sp/>)</highlight></codeline>
<codeline lineno="403"><highlight class="normal"></highlight></codeline>
<codeline lineno="404"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a6c1e1b68c68c6531b920c79ce5a42806" kindref="member">base_orientation</ref><sp/>=<sp/>selec_vector(self.vicon_client.signal(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a4f07757912f99abaea2a60467583caff" kindref="member">robot_vicon_name</ref></highlight></codeline>
<codeline lineno="405"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>+<sp/></highlight><highlight class="stringliteral">&quot;_position&quot;</highlight><highlight class="normal">),<sp/>3,7,<sp/></highlight><highlight class="stringliteral">&quot;base_orientation&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="406"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a3e8ac246a42a33475e381d2a1e1f338d" kindref="member">biased_base_pos_xyz</ref><sp/>=<sp/>subtract_vec_vec(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1aac090bcc93ca706025c8b57d8f8e0042" kindref="member">base_pos_xyz</ref>,</highlight></codeline>
<codeline lineno="407"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.control_switch_pos.sout,<sp/></highlight><highlight class="stringliteral">&quot;biased_pos&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="408"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a0dc4bd5452d58aea5234d5a190a4d4c7" kindref="member">biased_base_vel_xyz</ref><sp/>=<sp/>subtract_vec_vec(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1abd3dafeed32eb38408f8fd0e9977b923" kindref="member">base_vel_xyz</ref>,</highlight></codeline>
<codeline lineno="409"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.control_switch_vel.sout,<sp/></highlight><highlight class="stringliteral">&quot;biased_vel&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="410"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a6b8a3f691df20c4ea6020c2dc6e30d82" kindref="member">base_ang_vel_xyz</ref><sp/>=<sp/><sp/>selec_vector(self.vicon_client.signal(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a4f07757912f99abaea2a60467583caff" kindref="member">robot_vicon_name</ref></highlight></codeline>
<codeline lineno="411"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>+<sp/></highlight><highlight class="stringliteral">&quot;_velocity_body&quot;</highlight><highlight class="normal">),3,<sp/>6,<sp/></highlight><highlight class="stringliteral">&quot;selec_ang_dxyz&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="412"><highlight class="normal"></highlight></codeline>
<codeline lineno="413"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">####<sp/>LQR<sp/>equation:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="414"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">###should<sp/>be<sp/>removed</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="415"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(constVector([0.0,<sp/>0.0,<sp/>0.0],<sp/></highlight><highlight class="stringliteral">&quot;Kp_ang&quot;</highlight><highlight class="normal">),<sp/>self.com_imp_ctrl.Kp)</highlight></codeline>
<codeline lineno="416"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(constVector([0.0,<sp/>0.0,<sp/>0.0],<sp/></highlight><highlight class="stringliteral">&quot;Kp_ang&quot;</highlight><highlight class="normal">),<sp/>self.com_imp_ctrl.Kd)</highlight></codeline>
<codeline lineno="417"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(constVector([0.0,<sp/>0.0,<sp/>0.0],<sp/></highlight><highlight class="stringliteral">&quot;Kp_ang&quot;</highlight><highlight class="normal">),<sp/>self.com_imp_ctrl.Kp_ang)</highlight></codeline>
<codeline lineno="418"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(constVector([0.0,<sp/>0.0,<sp/>0.0],<sp/></highlight><highlight class="stringliteral">&quot;Kp_ang&quot;</highlight><highlight class="normal">),<sp/>self.com_imp_ctrl.Kd_ang)</highlight></codeline>
<codeline lineno="419"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(constVector([0.0,<sp/>0.0,<sp/>0.0],<sp/></highlight><highlight class="stringliteral">&quot;Kp_ang&quot;</highlight><highlight class="normal">),<sp/>self.com_imp_ctrl.inertia)</highlight></codeline>
<codeline lineno="420"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(constVector([0.0,<sp/>0.0,<sp/>0.0],<sp/></highlight><highlight class="stringliteral">&quot;Kp_ang&quot;</highlight><highlight class="normal">),<sp/>self.com_imp_ctrl.mass)</highlight></codeline>
<codeline lineno="421"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(constVector([0.0,<sp/>0.0,<sp/>0.0],<sp/></highlight><highlight class="stringliteral">&quot;Kp_ang&quot;</highlight><highlight class="normal">),<sp/>self.com_imp_ctrl.des_fft)</highlight></codeline>
<codeline lineno="422"><highlight class="normal"></highlight></codeline>
<codeline lineno="423"><highlight class="normal"></highlight></codeline>
<codeline lineno="424"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">###</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="425"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(des_lqr,<sp/>self.com_imp_ctrl.lqr_gain)</highlight></codeline>
<codeline lineno="426"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a3e8ac246a42a33475e381d2a1e1f338d" kindref="member">biased_base_pos_xyz</ref>,<sp/>self.com_imp_ctrl.biased_pos)</highlight></codeline>
<codeline lineno="427"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(des_pos,<sp/>self.com_imp_ctrl.des_pos)</highlight></codeline>
<codeline lineno="428"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a0dc4bd5452d58aea5234d5a190a4d4c7" kindref="member">biased_base_vel_xyz</ref>,<sp/>self.com_imp_ctrl.biased_vel)</highlight></codeline>
<codeline lineno="429"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(des_vel,<sp/>self.com_imp_ctrl.des_vel)</highlight></codeline>
<codeline lineno="430"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(des_fff,<sp/>self.com_imp_ctrl.des_fff)</highlight></codeline>
<codeline lineno="431"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a6c1e1b68c68c6531b920c79ce5a42806" kindref="member">base_orientation</ref>,<sp/>self.com_imp_ctrl.ori)</highlight></codeline>
<codeline lineno="432"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a6b8a3f691df20c4ea6020c2dc6e30d82" kindref="member">base_ang_vel_xyz</ref>,<sp/>self.com_imp_ctrl.angvel)</highlight></codeline>
<codeline lineno="433"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(des_ori,<sp/>self.com_imp_ctrl.des_ori)</highlight></codeline>
<codeline lineno="434"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(des_ang_vel,<sp/>self.com_imp_ctrl.des_ang_vel)</highlight></codeline>
<codeline lineno="435"><highlight class="normal"></highlight></codeline>
<codeline lineno="436"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>lqr_end_eff_force<sp/>=<sp/>self.com_imp_ctrl.end_eff_lqr_tau</highlight></codeline>
<codeline lineno="437"><highlight class="normal"></highlight></codeline>
<codeline lineno="438"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>torques_fl<sp/>=<sp/>selec_vector(lqr_end_eff_force,<sp/>0,<sp/>3,<sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a82f0b7c3180f2f9715dd92708581a8de" kindref="member">EntityName</ref><sp/>+<sp/></highlight><highlight class="stringliteral">&quot;torques_fl&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="439"><highlight class="normal"></highlight></codeline>
<codeline lineno="440"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>torques_fr<sp/>=<sp/>selec_vector(lqr_end_eff_force,<sp/>3,<sp/>6,<sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a82f0b7c3180f2f9715dd92708581a8de" kindref="member">EntityName</ref><sp/>+<sp/></highlight><highlight class="stringliteral">&quot;torques_fr&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="441"><highlight class="normal"></highlight></codeline>
<codeline lineno="442"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>torques_hl<sp/>=<sp/>selec_vector(lqr_end_eff_force,<sp/>6,<sp/>9,<sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a82f0b7c3180f2f9715dd92708581a8de" kindref="member">EntityName</ref><sp/>+<sp/></highlight><highlight class="stringliteral">&quot;torques_hl&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="443"><highlight class="normal"></highlight></codeline>
<codeline lineno="444"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>torques_hr<sp/>=<sp/>selec_vector(lqr_end_eff_force,<sp/>9,<sp/>12,<sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a82f0b7c3180f2f9715dd92708581a8de" kindref="member">EntityName</ref><sp/>+<sp/></highlight><highlight class="stringliteral">&quot;torques_hr&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="445"><highlight class="normal"></highlight></codeline>
<codeline lineno="446"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>torques_fl_6d<sp/>=<sp/>stack_two_vectors(torques_fl,</highlight></codeline>
<codeline lineno="447"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>zero_vec(3,<sp/></highlight><highlight class="stringliteral">&quot;stack_fl_tau&quot;</highlight><highlight class="normal">),<sp/>3,<sp/>3)</highlight></codeline>
<codeline lineno="448"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>torques_fr_6d<sp/>=<sp/>stack_two_vectors(torques_fr,</highlight></codeline>
<codeline lineno="449"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>zero_vec(3,<sp/></highlight><highlight class="stringliteral">&quot;stack_fr_tau&quot;</highlight><highlight class="normal">),<sp/>3,<sp/>3)</highlight></codeline>
<codeline lineno="450"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>torques_hl_6d<sp/>=<sp/>stack_two_vectors(torques_hl,</highlight></codeline>
<codeline lineno="451"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>zero_vec(3,<sp/></highlight><highlight class="stringliteral">&quot;stack_hl_tau&quot;</highlight><highlight class="normal">),<sp/>3,<sp/>3)</highlight></codeline>
<codeline lineno="452"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>torques_hr_6d<sp/>=<sp/>stack_two_vectors(torques_hr,</highlight></codeline>
<codeline lineno="453"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>zero_vec(3,<sp/></highlight><highlight class="stringliteral">&quot;stack_hr_tau&quot;</highlight><highlight class="normal">),<sp/>3,<sp/>3)</highlight></codeline>
<codeline lineno="454"><highlight class="normal"></highlight></codeline>
<codeline lineno="455"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>torques_fl_fr<sp/>=<sp/>stack_two_vectors(torques_fl_6d,torques_fr_6d,<sp/>6,<sp/>6)</highlight></codeline>
<codeline lineno="456"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>torques_hl_hr<sp/>=<sp/>stack_two_vectors(torques_hl_6d,torques_hr_6d,<sp/>6,<sp/>6)</highlight></codeline>
<codeline lineno="457"><highlight class="normal"></highlight></codeline>
<codeline lineno="458"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>lqr_end_eff_force_24d<sp/>=<sp/>stack_two_vectors(torques_fl_fr,<sp/>torques_hl_hr,<sp/>12,<sp/>12)</highlight></codeline>
<codeline lineno="459"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>lqr_end_eff_force_24d<sp/>=<sp/>mul_double_vec(1.0,<sp/>lqr_end_eff_force_24d,</highlight><highlight class="stringliteral">&quot;lqr_end_eff_force&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="460"><highlight class="normal"></highlight></codeline>
<codeline lineno="461"><highlight class="normal"></highlight></codeline>
<codeline lineno="462"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>lqr_end_eff_force_24d</highlight></codeline>
<codeline lineno="463"><highlight class="normal"></highlight></codeline>
<codeline lineno="464"><highlight class="normal"></highlight></codeline>
<codeline lineno="465"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">return_com_torques(self,<sp/>com_tau,<sp/>ang_tau,<sp/>des_abs_vel,<sp/>hess,<sp/>g0,<sp/>ce,<sp/>ci,<sp/>ci0,<sp/>reg,<sp/>cnt_plan<sp/>=<sp/>None):</highlight></codeline>
<codeline lineno="466"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">###<sp/>This<sp/>divides<sp/>forces<sp/>using<sp/>the<sp/>wbc<sp/>controller</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="467"><highlight class="normal"></highlight></codeline>
<codeline lineno="468"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(com_tau,<sp/>self.com_imp_ctrl.lctrl)</highlight></codeline>
<codeline lineno="469"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(ang_tau,<sp/>self.com_imp_ctrl.actrl)</highlight></codeline>
<codeline lineno="470"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(des_abs_vel,<sp/>self.com_imp_ctrl.abs_end_eff_vel)</highlight></codeline>
<codeline lineno="471"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(hess,<sp/>self.com_imp_ctrl.hess)</highlight></codeline>
<codeline lineno="472"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(g0,<sp/>self.com_imp_ctrl.g0)</highlight></codeline>
<codeline lineno="473"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(ce,<sp/>self.com_imp_ctrl.ce)</highlight></codeline>
<codeline lineno="474"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(ci,<sp/>self.com_imp_ctrl.ci)</highlight></codeline>
<codeline lineno="475"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(ci0,<sp/>self.com_imp_ctrl.ci0)</highlight></codeline>
<codeline lineno="476"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(reg,<sp/>self.com_imp_ctrl.reg)</highlight></codeline>
<codeline lineno="477"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>cnt_plan<sp/>==<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="478"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>thr_cnt_sensor<sp/>=<sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a9c37016b0e903660cbf38885b9bee52e" kindref="member">threshold_cnt_sensor</ref>()</highlight></codeline>
<codeline lineno="479"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(thr_cnt_sensor,<sp/>self.com_imp_ctrl.thr_cnt_value)</highlight></codeline>
<codeline lineno="480"><highlight class="normal"></highlight></codeline>
<codeline lineno="481"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="482"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(cnt_plan,<sp/>self.com_imp_ctrl.cnt_sensor)</highlight></codeline>
<codeline lineno="483"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(cnt_plan,<sp/>self.com_imp_ctrl.thr_cnt_value)</highlight></codeline>
<codeline lineno="484"><highlight class="normal"></highlight></codeline>
<codeline lineno="485"><highlight class="normal"></highlight></codeline>
<codeline lineno="486"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a91ffd9fe58d946e2326b05b5f808c8f4" kindref="member">wb_ctrl</ref><sp/>=<sp/>self.com_imp_ctrl.wbctrl</highlight></codeline>
<codeline lineno="487"><highlight class="normal"></highlight></codeline>
<codeline lineno="488"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">##<sp/>Thresholding<sp/>with<sp/>contact<sp/>sensor<sp/>to<sp/>make<sp/>forces<sp/>event<sp/>based</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="489"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>fl_cnt_value<sp/>=<sp/>self.convert_cnt_value_to_3d(thr_cnt_sensor,<sp/>0,<sp/>1,<sp/>&quot;fl_cnt_3d&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="490"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>fr_cnt_value<sp/>=<sp/>self.convert_cnt_value_to_3d(thr_cnt_sensor,<sp/>1,<sp/>2,<sp/>&quot;fr_cnt_3d&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="491"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>hl_cnt_value<sp/>=<sp/>self.convert_cnt_value_to_3d(thr_cnt_sensor,<sp/>2,<sp/>3,<sp/>&quot;hl_cnt_3d&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="492"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>hr_cnt_value<sp/>=<sp/>self.convert_cnt_value_to_3d(thr_cnt_sensor,<sp/>3,<sp/>4,<sp/>&quot;hr_cnt_3d&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="493"><highlight class="normal"></highlight></codeline>
<codeline lineno="494"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>torques_fl<sp/>=<sp/>selec_vector(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a91ffd9fe58d946e2326b05b5f808c8f4" kindref="member">wb_ctrl</ref>,<sp/>0,<sp/>3,<sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a82f0b7c3180f2f9715dd92708581a8de" kindref="member">EntityName</ref><sp/>+<sp/></highlight><highlight class="stringliteral">&quot;torques_fl&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="495"><highlight class="normal"></highlight><highlight class="comment">#<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>torques_fl<sp/>=<sp/>mul_vec_vec(fl_cnt_value,<sp/>torques_fl,<sp/>self.EntityName<sp/>+<sp/>&quot;fused_torques_fl&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="496"><highlight class="normal"></highlight></codeline>
<codeline lineno="497"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>torques_fr<sp/>=<sp/>selec_vector(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a91ffd9fe58d946e2326b05b5f808c8f4" kindref="member">wb_ctrl</ref>,<sp/>3,<sp/>6,<sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a82f0b7c3180f2f9715dd92708581a8de" kindref="member">EntityName</ref><sp/>+<sp/></highlight><highlight class="stringliteral">&quot;torques_fr&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="498"><highlight class="normal"></highlight><highlight class="comment">#<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>torques_fr<sp/>=<sp/>mul_vec_vec(fr_cnt_value,<sp/>torques_fr,<sp/>self.EntityName<sp/>+<sp/>&quot;fused_torques_fr&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="499"><highlight class="normal"></highlight></codeline>
<codeline lineno="500"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>torques_hl<sp/>=<sp/>selec_vector(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a91ffd9fe58d946e2326b05b5f808c8f4" kindref="member">wb_ctrl</ref>,<sp/>6,<sp/>9,<sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a82f0b7c3180f2f9715dd92708581a8de" kindref="member">EntityName</ref><sp/>+<sp/></highlight><highlight class="stringliteral">&quot;torques_hl&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="501"><highlight class="normal"></highlight><highlight class="comment">#<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>torques_hl<sp/>=<sp/>mul_vec_vec(hl_cnt_value,<sp/>torques_hl,<sp/>self.EntityName<sp/>+<sp/>&quot;fused_torques_hl&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="502"><highlight class="normal"></highlight></codeline>
<codeline lineno="503"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>torques_hr<sp/>=<sp/>selec_vector(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a91ffd9fe58d946e2326b05b5f808c8f4" kindref="member">wb_ctrl</ref>,<sp/>9,<sp/>12,<sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a82f0b7c3180f2f9715dd92708581a8de" kindref="member">EntityName</ref><sp/>+<sp/></highlight><highlight class="stringliteral">&quot;torques_hr&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="504"><highlight class="normal"></highlight><highlight class="comment">#<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>torques_hr<sp/>=<sp/>mul_vec_vec(hr_cnt_value,<sp/>torques_hr,<sp/>self.EntityName<sp/>+<sp/>&quot;fused_torques_hr&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="505"><highlight class="normal"></highlight></codeline>
<codeline lineno="506"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>torques_fl_6d<sp/>=<sp/>stack_two_vectors(torques_fl,</highlight></codeline>
<codeline lineno="507"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>zero_vec(3,<sp/></highlight><highlight class="stringliteral">&quot;stack_fl_tau&quot;</highlight><highlight class="normal">),<sp/>3,<sp/>3)</highlight></codeline>
<codeline lineno="508"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>torques_fr_6d<sp/>=<sp/>stack_two_vectors(torques_fr,</highlight></codeline>
<codeline lineno="509"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>zero_vec(3,<sp/></highlight><highlight class="stringliteral">&quot;stack_fr_tau&quot;</highlight><highlight class="normal">),<sp/>3,<sp/>3)</highlight></codeline>
<codeline lineno="510"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>torques_hl_6d<sp/>=<sp/>stack_two_vectors(torques_hl,</highlight></codeline>
<codeline lineno="511"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>zero_vec(3,<sp/></highlight><highlight class="stringliteral">&quot;stack_hl_tau&quot;</highlight><highlight class="normal">),<sp/>3,<sp/>3)</highlight></codeline>
<codeline lineno="512"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>torques_hr_6d<sp/>=<sp/>stack_two_vectors(torques_hr,</highlight></codeline>
<codeline lineno="513"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>zero_vec(3,<sp/></highlight><highlight class="stringliteral">&quot;stack_hr_tau&quot;</highlight><highlight class="normal">),<sp/>3,<sp/>3)</highlight></codeline>
<codeline lineno="514"><highlight class="normal"></highlight></codeline>
<codeline lineno="515"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>torques_fl_fr<sp/>=<sp/>stack_two_vectors(torques_fl_6d,torques_fr_6d,<sp/>6,<sp/>6)</highlight></codeline>
<codeline lineno="516"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>torques_hl_hr<sp/>=<sp/>stack_two_vectors(torques_hl_6d,torques_hr_6d,<sp/>6,<sp/>6)</highlight></codeline>
<codeline lineno="517"><highlight class="normal"></highlight></codeline>
<codeline lineno="518"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wbc_torques<sp/>=<sp/>stack_two_vectors(torques_fl_fr,<sp/>torques_hl_hr,<sp/>12,<sp/>12)</highlight></codeline>
<codeline lineno="519"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">##<sp/>hack<sp/>to<sp/>allow<sp/>tracking<sp/>of<sp/>torques</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="520"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wbc_torques<sp/>=<sp/>mul_double_vec(1.0,<sp/>wbc_torques,</highlight><highlight class="stringliteral">&quot;com_torques&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="521"><highlight class="normal"></highlight></codeline>
<codeline lineno="522"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>wbc_torques</highlight></codeline>
<codeline lineno="523"><highlight class="normal"></highlight></codeline>
<codeline lineno="524"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">record_data(self):</highlight></codeline>
<codeline lineno="525"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a471495c1adac63c6cb9a521fea0b52d6" kindref="member">get_biased_base_position</ref>()</highlight></codeline>
<codeline lineno="526"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1af130be175b4257723b48248e1ec41ab4" kindref="member">get_biased_base_velocity</ref>()</highlight></codeline>
<codeline lineno="527"><highlight class="normal"></highlight></codeline>
<codeline lineno="528"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.robot.add_trace(self.com_imp_ctrl.name,<sp/></highlight><highlight class="stringliteral">&quot;des_pos&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="529"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.robot.add_trace(self.com_imp_ctrl.name,<sp/></highlight><highlight class="stringliteral">&quot;des_vel&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="530"><highlight class="normal"></highlight></codeline>
<codeline lineno="531"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.robot.add_trace(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a82f0b7c3180f2f9715dd92708581a8de" kindref="member">EntityName</ref><sp/>+<sp/></highlight><highlight class="stringliteral">&apos;_biased_base_pos&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;sout&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="532"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.robot.add_trace(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a82f0b7c3180f2f9715dd92708581a8de" kindref="member">EntityName</ref><sp/>+<sp/></highlight><highlight class="stringliteral">&apos;_biased_base_vel&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;sout&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="533"><highlight class="normal"></highlight></codeline>
<codeline lineno="534"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.robot.add_trace(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a82f0b7c3180f2f9715dd92708581a8de" kindref="member">EntityName</ref>,<sp/></highlight><highlight class="stringliteral">&quot;tau&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="535"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>self.robot.add_ros_and_trace(self.EntityName,<sp/>&quot;tau&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="536"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>#</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="537"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.robot.add_trace(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a82f0b7c3180f2f9715dd92708581a8de" kindref="member">EntityName</ref>,<sp/></highlight><highlight class="stringliteral">&quot;angtau&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="538"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>self.robot.add_ros_and_trace(self.EntityName,<sp/>&quot;angtau&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="539"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>#</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="540"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="541"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.robot.add_trace(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1quad__leg__impedance__controller_1_1QuadrupedComControl_1a82f0b7c3180f2f9715dd92708581a8de" kindref="member">EntityName</ref>,<sp/></highlight><highlight class="stringliteral">&quot;wbctrl&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="542"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>self.robot.add_ros_and_trace(self.EntityName,<sp/>&quot;wbctrl&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="543"><highlight class="normal"></highlight></codeline>
<codeline lineno="544"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>self.robot.add_trace(self.EntityName,<sp/>&quot;lqrtau&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="545"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>self.robot.add_ros_and_trace(self.EntityName,<sp/>&quot;lqrtau&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="546"><highlight class="normal"></highlight></codeline>
<codeline lineno="547"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>self.robot.add_trace(self.EntityName,<sp/>&quot;thr_cnt_sensor&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="548"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>self.robot.add_ros_and_trace(self.EntityName,<sp/>&quot;thr_cnt_sensor&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="549"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="550"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.robot.add_trace(</highlight><highlight class="stringliteral">&quot;com_torques&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;sout&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="551"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>self.robot.add_ros_and_trace(&quot;com_torques&quot;,<sp/>&quot;sout&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="552"><highlight class="normal"></highlight></codeline>
<codeline lineno="553"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>self.robot.add_trace(self.EntityName,<sp/>&quot;end_eff_lqr_tau&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="554"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>self.robot.add_ros_and_trace(self.EntityName,<sp/>&quot;end_eff_lqr_tau&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="555"><highlight class="normal"></highlight></codeline>
<codeline lineno="556"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>self.robot.add_trace(&quot;lqr_end_eff_force&quot;,<sp/>&quot;sout&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="557"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>self.robot.add_ros_and_trace(&quot;lqr_end_eff_force&quot;,<sp/>&quot;sout&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="558"><highlight class="normal"></highlight></codeline>
<codeline lineno="559"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.robot.add_trace(</highlight><highlight class="stringliteral">&quot;biased_pos&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;sout&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="560"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>self.robot.add_ros_and_trace(&quot;biased_pos&quot;,<sp/>&quot;sout&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="561"><highlight class="normal"></highlight></codeline>
<codeline lineno="562"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="563"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.robot.add_trace(</highlight><highlight class="stringliteral">&quot;biased_vel&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;sout&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="564"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>self.robot.add_ros_and_trace(&quot;biased_vel&quot;,<sp/>&quot;sout&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="565"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>#</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="566"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>self.robot.add_trace(&quot;quad_com_ctrl&quot;,<sp/>&quot;lqrtau&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="567"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>self.robot.add_ros_and_trace(&quot;quad_com_ctrl&quot;,<sp/>&quot;lqrtau&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="568"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="569"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>self.robot.add_trace(&quot;lqr_error&quot;,<sp/>&quot;sout&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="570"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>self.robot.add_ros_and_trace(&quot;lqr_error&quot;,<sp/>&quot;sout&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="571"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="572"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>self.robot.add_trace(&quot;lqr_com_force&quot;,<sp/>&quot;sout&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="573"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>self.robot.add_ros_and_trace(&quot;lqr_com_force&quot;,<sp/>&quot;sout&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="574"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="575"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>self.robot.add_trace(&quot;f_hr_3d&quot;,<sp/>&quot;sout&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="576"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>self.robot.add_ros_and_trace(&quot;f_hr_3d&quot;,<sp/>&quot;sout&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="577"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="578"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="579"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>self.robot.add_trace(&quot;des_fff_lqr&quot;,<sp/>&quot;sout&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="580"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>self.robot.add_ros_and_trace(&quot;des_fff_lqr&quot;,<sp/>&quot;sout&quot;)</highlight><highlight class="normal"></highlight></codeline>
    </programlisting>
    <location file="python/dg_tools/leg_impedance_control/quad_leg_impedance_controller.py"/>
  </compounddef>
</doxygen>
