<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.11">
  <compounddef id="leg__impedance__controller_8py" kind="file" language="Python">
    <compoundname>leg_impedance_controller.py</compoundname>
    <innerclass refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController" prot="public">python::dg_tools::leg_impedance_control::leg_impedance_controller::LegImpedanceController</innerclass>
    <innernamespace refid="namespacepython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller">python::dg_tools::leg_impedance_control::leg_impedance_controller</innernamespace>
    <innernamespace refid="namespacedg__blmc__robots">dg_blmc_robots</innernamespace>
    <briefdescription>
<para>This code contains implementation of leg impedance impedance_controller. </para>    </briefdescription>
    <detaileddescription>
<para><simplesect kind="author"><para>Avadesh Meduri </para></simplesect>
<xrefsect id="license_1_license000013"><xreftitle>License</xreftitle><xrefdescription><para>License BSD-3-Clause </para></xrefdescription></xrefsect><simplesect kind="copyright"><para>Copyright (c) 2019, New York University and Max Planck Gesellschaft. </para></simplesect>
<simplesect kind="date"><para>2019-02-06 </para></simplesect>
</para>    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="2"><highlight class="stringliteral">@package<sp/>dg_blmc_robots</highlight></codeline>
<codeline lineno="3"><highlight class="stringliteral">@file<sp/>leg_impedance_controller.py</highlight></codeline>
<codeline lineno="4"><highlight class="stringliteral">@author<sp/>Avadesh<sp/>Meduri</highlight></codeline>
<codeline lineno="5"><highlight class="stringliteral">@license<sp/>License<sp/>BSD-3-Clause</highlight></codeline>
<codeline lineno="6"><highlight class="stringliteral">@copyright<sp/>Copyright<sp/>(c)<sp/>2019,<sp/>New<sp/>York<sp/>University<sp/>and<sp/>Max<sp/>Planck<sp/>Gesellschaft.</highlight></codeline>
<codeline lineno="7"><highlight class="stringliteral">@date<sp/>2019-02-06</highlight></codeline>
<codeline lineno="8"><highlight class="stringliteral">@brief<sp/>This<sp/>code<sp/>contains<sp/>implementation<sp/>of<sp/>leg<sp/>impedance<sp/>impedance_controller</highlight></codeline>
<codeline lineno="9"><highlight class="stringliteral">&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight><highlight class="comment">####################<sp/>Imports<sp/>#################################################</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight></codeline>
<codeline lineno="13"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>dg_tools.utils<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>*</highlight></codeline>
<codeline lineno="14"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>dg_tools.traj_generators<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>mul_double_vec_2</highlight></codeline>
<codeline lineno="15"><highlight class="normal"></highlight></codeline>
<codeline lineno="16"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>py_robot_properties_teststand.config<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>TeststandConfig</highlight></codeline>
<codeline lineno="17"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>dynamic_graph.sot.dynamics_pinocchio<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>dp</highlight></codeline>
<codeline lineno="18"><highlight class="normal"></highlight></codeline>
<codeline lineno="19"><highlight class="normal"></highlight></codeline>
<codeline lineno="20"><highlight class="normal"></highlight><highlight class="comment">#############################################################################</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="21"><highlight class="normal"></highlight></codeline>
<codeline lineno="22" refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController" kindref="compound">LegImpedanceController</ref>():</highlight></codeline>
<codeline lineno="23"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">__init__(self,<sp/>leg_name):</highlight></codeline>
<codeline lineno="24"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1a8094365ea991d0c5d1f54d8ff75bff86" kindref="member">leg_name</ref><sp/>=<sp/>leg_name</highlight></codeline>
<codeline lineno="25"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1a3a887b72be4a41ba4cab4457fd935e90" kindref="member">robot_pin</ref><sp/>=<sp/>TeststandConfig.buildRobotWrapper()</highlight></codeline>
<codeline lineno="26"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1aa8cf0226bf2c1583ad3edc4079fa6bfb" kindref="member">robot_dg</ref><sp/>=<sp/>dp.DynamicPinocchio(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1a8094365ea991d0c5d1f54d8ff75bff86" kindref="member">leg_name</ref>)</highlight></codeline>
<codeline lineno="27"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.robot_dg.setModel(self.robot_pin.model)</highlight></codeline>
<codeline lineno="28"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.robot_dg.setData(self.robot_pin.data)</highlight></codeline>
<codeline lineno="29"><highlight class="normal"></highlight></codeline>
<codeline lineno="30"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.robot_dg.createJacobianEndEffWorld(</highlight></codeline>
<codeline lineno="31"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;jac_cnt_&apos;</highlight><highlight class="normal"><sp/>+<sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1a8094365ea991d0c5d1f54d8ff75bff86" kindref="member">leg_name</ref>,<sp/></highlight><highlight class="stringliteral">&apos;contact&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="32"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.robot_dg.createPosition(</highlight><highlight class="stringliteral">&apos;pos_hip_&apos;</highlight><highlight class="normal"><sp/>+<sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1a8094365ea991d0c5d1f54d8ff75bff86" kindref="member">leg_name</ref>,<sp/></highlight><highlight class="stringliteral">&apos;HFE&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="33"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.robot_dg.createPosition(</highlight><highlight class="stringliteral">&apos;pos_foot_&apos;</highlight><highlight class="normal"><sp/>+<sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1a8094365ea991d0c5d1f54d8ff75bff86" kindref="member">leg_name</ref>,<sp/></highlight><highlight class="stringliteral">&apos;END&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="34"><highlight class="normal"></highlight></codeline>
<codeline lineno="35"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>print(</highlight><highlight class="stringliteral">&quot;Warning:<sp/>Robot<sp/>acceleration<sp/>has<sp/>been<sp/>set<sp/>to<sp/>zero&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="36"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.robot_dg.acceleration.value<sp/>=<sp/>3<sp/>*<sp/>(0.0,<sp/>)</highlight></codeline>
<codeline lineno="37"><highlight class="normal"></highlight></codeline>
<codeline lineno="38"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1a2d97fcd05ed8588b59b6a71d03374f77" kindref="member">joint_positions_sin</ref><sp/>=<sp/>self.robot_dg.position</highlight></codeline>
<codeline lineno="39"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1a381159ee8e5924469b8912e9b3213fd2" kindref="member">joint_velocities_sin</ref><sp/>=<sp/>self.robot_dg.velocity</highlight></codeline>
<codeline lineno="40"><highlight class="normal"></highlight></codeline>
<codeline lineno="41"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">_compute_control_torques(self,<sp/>start_index=1,<sp/>end_index=3):</highlight></codeline>
<codeline lineno="42"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;&apos;&apos;</highlight></codeline>
<codeline lineno="43"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>##<sp/>computes<sp/>torques<sp/>tau<sp/>=<sp/>JacT*(errors)</highlight></codeline>
<codeline lineno="44"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>##<sp/>Input<sp/>:<sp/>start_index<sp/>(to<sp/>select<sp/>actuated<sp/>torques<sp/>to<sp/>plug<sp/>ot<sp/>the<sp/>robot)</highlight></codeline>
<codeline lineno="45"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:<sp/>end_index<sp/>(to<sp/>select<sp/>actuated<sp/>torques<sp/>to<sp/>plug<sp/>to<sp/>the<sp/>robot)</highlight></codeline>
<codeline lineno="46"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;&apos;&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="47"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>jacT<sp/>=<sp/>transpose_mat(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1a0e30827957a254793f36cc9b619f8c41" kindref="member">jac</ref>,<sp/></highlight><highlight class="stringliteral">&quot;jacTranspose&quot;</highlight><highlight class="normal"><sp/>+<sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1a8094365ea991d0c5d1f54d8ff75bff86" kindref="member">leg_name</ref>)</highlight></codeline>
<codeline lineno="48"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>multiplying<sp/>negative</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="49"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>errors<sp/>=<sp/>mul_double_vec(-1.0,<sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1acb3c2792b4b35c6b7606023adbc09001" kindref="member">total_error</ref>,</highlight></codeline>
<codeline lineno="50"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;neg_op_&quot;</highlight><highlight class="normal"><sp/>+<sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1a8094365ea991d0c5d1f54d8ff75bff86" kindref="member">leg_name</ref>)</highlight></codeline>
<codeline lineno="51"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>control_torques<sp/>=<sp/>multiply_mat_vec(</highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>jacT,<sp/>errors,<sp/></highlight><highlight class="stringliteral">&quot;compute_control_torques_&quot;</highlight><highlight class="normal"><sp/>+<sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1a8094365ea991d0c5d1f54d8ff75bff86" kindref="member">leg_name</ref>)</highlight></codeline>
<codeline lineno="53"><highlight class="normal"></highlight></codeline>
<codeline lineno="54"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>selecting<sp/>the<sp/>torques<sp/>to<sp/>be<sp/>plugged<sp/>to<sp/>the<sp/>robot</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="55"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sel<sp/>=<sp/>Selec_of_vector(</highlight><highlight class="stringliteral">&quot;impedance_torques_&quot;</highlight><highlight class="normal"><sp/>+<sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1a8094365ea991d0c5d1f54d8ff75bff86" kindref="member">leg_name</ref>)</highlight></codeline>
<codeline lineno="56"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sel.selec(start_index,<sp/>end_index)</highlight></codeline>
<codeline lineno="57"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(control_torques,<sp/>sel.signal(</highlight><highlight class="stringliteral">&apos;sin&apos;</highlight><highlight class="normal">))</highlight></codeline>
<codeline lineno="58"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>sel.signal(</highlight><highlight class="stringliteral">&apos;sout&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="59"><highlight class="normal"></highlight></codeline>
<codeline lineno="60"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1a4c88fb5d9e5a89c4cb1df9198475bda9" kindref="member">return_leg_length</ref>(self):</highlight></codeline>
<codeline lineno="61"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;&apos;&apos;</highlight></codeline>
<codeline lineno="62"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>###<sp/>Computes<sp/>current<sp/>leg<sp/>length</highlight></codeline>
<codeline lineno="63"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;&apos;&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="64"><highlight class="normal"></highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1ad8c5846d949a1e14cd91255e96d9161c" kindref="member">xyzpos_hip</ref><sp/>=<sp/>hom2pos(self.robot_dg.signal(</highlight></codeline>
<codeline lineno="66"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;pos_hip_&quot;</highlight><highlight class="normal"><sp/>+<sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1a8094365ea991d0c5d1f54d8ff75bff86" kindref="member">leg_name</ref>),<sp/></highlight><highlight class="stringliteral">&quot;xyzpos_hip_&quot;</highlight><highlight class="normal"><sp/>+<sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1a8094365ea991d0c5d1f54d8ff75bff86" kindref="member">leg_name</ref>)</highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1ae2d266ce60200f5c3d4a273863e444bb" kindref="member">xyzpos_foot</ref><sp/>=<sp/>hom2pos(self.robot_dg.signal(</highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;pos_foot_&quot;</highlight><highlight class="normal"><sp/>+<sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1a8094365ea991d0c5d1f54d8ff75bff86" kindref="member">leg_name</ref>),<sp/></highlight><highlight class="stringliteral">&quot;xyzpos_foot_&quot;</highlight><highlight class="normal"><sp/>+<sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1a8094365ea991d0c5d1f54d8ff75bff86" kindref="member">leg_name</ref>)</highlight></codeline>
<codeline lineno="69"><highlight class="normal"></highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Relative<sp/>position<sp/>of<sp/>foot<sp/>with<sp/>respect<sp/>to<sp/>the<sp/>base<sp/>of<sp/>the<sp/>foot</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1afe97a475184a29f5f43092afcd01d673" kindref="member">rel_pos_foot</ref><sp/>=<sp/>subtract_vec_vec(</highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1ae2d266ce60200f5c3d4a273863e444bb" kindref="member">xyzpos_foot</ref>,<sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1ad8c5846d949a1e14cd91255e96d9161c" kindref="member">xyzpos_hip</ref>,<sp/></highlight><highlight class="stringliteral">&quot;rel_pos_foot_&quot;</highlight><highlight class="normal"><sp/>+<sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1a8094365ea991d0c5d1f54d8ff75bff86" kindref="member">leg_name</ref>)</highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1afe97a475184a29f5f43092afcd01d673" kindref="member">rel_pos_foot</ref><sp/>=<sp/>stack_two_vectors(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1afe97a475184a29f5f43092afcd01d673" kindref="member">rel_pos_foot</ref>,<sp/>constVector(</highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[0.0,<sp/>0.0,<sp/>0.0],<sp/></highlight><highlight class="stringliteral">&apos;stack_to_wrench_&apos;</highlight><highlight class="normal"><sp/>+<sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1a8094365ea991d0c5d1f54d8ff75bff86" kindref="member">leg_name</ref>),<sp/>3,<sp/>3)</highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1afe97a475184a29f5f43092afcd01d673" kindref="member">rel_pos_foot</ref></highlight></codeline>
<codeline lineno="76"><highlight class="normal"></highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">return_control_torques(self,<sp/>kp,<sp/>des_pos,<sp/>kd=None,<sp/>des_vel=None,<sp/>kf=None,<sp/>fff=None):</highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;&apos;&apos;</highlight></codeline>
<codeline lineno="79"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>##<sp/>Impedance<sp/>controller<sp/>implementation.<sp/>Creates<sp/>a<sp/>virtual<sp/>spring</highlight></codeline>
<codeline lineno="80"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>##<sp/>damper<sp/>system<sp/>the<sp/>base<sp/>and<sp/>foot<sp/>of<sp/>the<sp/>leg</highlight></codeline>
<codeline lineno="81"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>##<sp/>Input<sp/>:<sp/>Kp<sp/>-<sp/>proportional<sp/>gain</highlight></codeline>
<codeline lineno="82"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:<sp/>Kd<sp/>-<sp/>derivative<sp/>gain</highlight></codeline>
<codeline lineno="83"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:<sp/>des_pos<sp/>-<sp/>desired<sp/>position<sp/>(size<sp/>:<sp/>1*6<sp/>)</highlight></codeline>
<codeline lineno="84"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:<sp/>des_vel<sp/>-<sp/>desired<sp/>velocity<sp/>(size<sp/>:<sp/>1*6<sp/>)</highlight></codeline>
<codeline lineno="85"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:<sp/>Kf<sp/>-<sp/>feed<sp/>forward<sp/>force<sp/>gain<sp/>(safety)</highlight></codeline>
<codeline lineno="86"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:<sp/>fff<sp/>-<sp/>feed<sp/>forward<sp/>force<sp/>(size<sp/>:<sp/>1*6)</highlight></codeline>
<codeline lineno="87"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;&apos;&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1ad8b54c7826ccaba33e7bb99e13b1e177" kindref="member">rct_args</ref><sp/>=<sp/>dict()</highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1ad8b54c7826ccaba33e7bb99e13b1e177" kindref="member">rct_args</ref>[</highlight><highlight class="stringliteral">&quot;kp&quot;</highlight><highlight class="normal">]<sp/>=<sp/>kp</highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1ad8b54c7826ccaba33e7bb99e13b1e177" kindref="member">rct_args</ref>[</highlight><highlight class="stringliteral">&quot;des_pos&quot;</highlight><highlight class="normal">]<sp/>=<sp/>des_pos</highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1ad8b54c7826ccaba33e7bb99e13b1e177" kindref="member">rct_args</ref>[</highlight><highlight class="stringliteral">&quot;kd&quot;</highlight><highlight class="normal">]<sp/>=<sp/>kd</highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1ad8b54c7826ccaba33e7bb99e13b1e177" kindref="member">rct_args</ref>[</highlight><highlight class="stringliteral">&quot;des_vel&quot;</highlight><highlight class="normal">]<sp/>=<sp/>des_vel</highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1ad8b54c7826ccaba33e7bb99e13b1e177" kindref="member">rct_args</ref>[</highlight><highlight class="stringliteral">&quot;kf&quot;</highlight><highlight class="normal">]<sp/>=<sp/>kf</highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1ad8b54c7826ccaba33e7bb99e13b1e177" kindref="member">rct_args</ref>[</highlight><highlight class="stringliteral">&quot;fff&quot;</highlight><highlight class="normal">]<sp/>=<sp/>fff</highlight></codeline>
<codeline lineno="95"><highlight class="normal"></highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1a0e30827957a254793f36cc9b619f8c41" kindref="member">jac</ref><sp/>=<sp/>self.robot_dg.signal(</highlight><highlight class="stringliteral">&quot;jac_cnt_&quot;</highlight><highlight class="normal"><sp/>+<sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1a8094365ea991d0c5d1f54d8ff75bff86" kindref="member">leg_name</ref>)</highlight></codeline>
<codeline lineno="97"><highlight class="normal"></highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1a4c88fb5d9e5a89c4cb1df9198475bda9" kindref="member">return_leg_length</ref>()</highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1a8f54abb271f0fb18516871c454ead08b" kindref="member">pos_error</ref><sp/>=<sp/>subtract_vec_vec(</highlight></codeline>
<codeline lineno="100"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1afe97a475184a29f5f43092afcd01d673" kindref="member">rel_pos_foot</ref>,<sp/>des_pos,<sp/></highlight><highlight class="stringliteral">&quot;pos_error_&quot;</highlight><highlight class="normal"><sp/>+<sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1a8094365ea991d0c5d1f54d8ff75bff86" kindref="member">leg_name</ref>)</highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mul_kp_gains_split<sp/>=<sp/>Multiply_of_vector(</highlight><highlight class="stringliteral">&quot;kp_split_&quot;</highlight><highlight class="normal"><sp/>+<sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1a8094365ea991d0c5d1f54d8ff75bff86" kindref="member">leg_name</ref>)</highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(kp,<sp/>mul_kp_gains_split.sin0)</highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1a8f54abb271f0fb18516871c454ead08b" kindref="member">pos_error</ref>,<sp/>mul_kp_gains_split.sin1)</highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pos_error_with_gains<sp/>=<sp/>mul_kp_gains_split.sout</highlight></codeline>
<codeline lineno="105"><highlight class="normal"></highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>kd<sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"><sp/>des_vel<sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>print(</highlight><highlight class="stringliteral">&quot;Kd<sp/>!!!!!&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1ad8d7dd70797a5c9190b2454a51d3312a" kindref="member">rel_vel_foot</ref><sp/>=<sp/>multiply_mat_vec(</highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1a0e30827957a254793f36cc9b619f8c41" kindref="member">jac</ref>,<sp/>self.robot_dg.velocity,<sp/></highlight><highlight class="stringliteral">&quot;rel_vel_foot_&quot;</highlight><highlight class="normal"><sp/>+<sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1a8094365ea991d0c5d1f54d8ff75bff86" kindref="member">leg_name</ref>)</highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1ae7c6a380c196ceeedd7e5067c8995600" kindref="member">vel_error</ref><sp/>=<sp/>subtract_vec_vec(</highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1ad8d7dd70797a5c9190b2454a51d3312a" kindref="member">rel_vel_foot</ref>,<sp/>des_vel,<sp/></highlight><highlight class="stringliteral">&quot;vel_error_&quot;</highlight><highlight class="normal"><sp/>+<sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1a8094365ea991d0c5d1f54d8ff75bff86" kindref="member">leg_name</ref>)</highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mul_kd_gains_split<sp/>=<sp/>Multiply_of_vector(</highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;kd_split_&quot;</highlight><highlight class="normal"><sp/>+<sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1a8094365ea991d0c5d1f54d8ff75bff86" kindref="member">leg_name</ref>)</highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(kd,<sp/>mul_kd_gains_split.sin0)</highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1ae7c6a380c196ceeedd7e5067c8995600" kindref="member">vel_error</ref>,<sp/>mul_kd_gains_split.sin1)</highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>vel_error_with_gains<sp/>=<sp/>mul_kd_gains_split.sout</highlight></codeline>
<codeline lineno="117"><highlight class="normal"></highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1ac084d227c1362c85e910196812864ec4" kindref="member">pd_error</ref><sp/>=<sp/>add_vec_vec(</highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pos_error_with_gains,<sp/>vel_error_with_gains,<sp/></highlight><highlight class="stringliteral">&quot;pd_error_&quot;</highlight><highlight class="normal"><sp/>+<sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1a8094365ea991d0c5d1f54d8ff75bff86" kindref="member">leg_name</ref>)</highlight></codeline>
<codeline lineno="120"><highlight class="normal"></highlight></codeline>
<codeline lineno="121"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1ac084d227c1362c85e910196812864ec4" kindref="member">pd_error</ref><sp/>=<sp/>pos_error_with_gains</highlight></codeline>
<codeline lineno="123"><highlight class="normal"></highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>kf<sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"><sp/>fff<sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>print(</highlight><highlight class="stringliteral">&quot;fff<sp/>is<sp/>plugged<sp/>....&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mul_kf_gains<sp/>=<sp/>Multiply_double_vector(</highlight><highlight class="stringliteral">&quot;Kf_&quot;</highlight><highlight class="normal"><sp/>+<sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1a8094365ea991d0c5d1f54d8ff75bff86" kindref="member">leg_name</ref>)</highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(kf,<sp/>mul_kf_gains.sin1)</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plug(fff,<sp/>mul_kf_gains.sin2)</highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fff_with_gains<sp/>=<sp/>mul_kf_gains.sout</highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1acb3c2792b4b35c6b7606023adbc09001" kindref="member">total_error</ref><sp/>=<sp/>add_vec_vec(</highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fff_with_gains,<sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1ac084d227c1362c85e910196812864ec4" kindref="member">pd_error</ref>,<sp/></highlight><highlight class="stringliteral">&quot;total_error_&quot;</highlight><highlight class="normal"><sp/>+<sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1a8094365ea991d0c5d1f54d8ff75bff86" kindref="member">leg_name</ref>)</highlight></codeline>
<codeline lineno="132"><highlight class="normal"></highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1ac02390fb0ab1a6c9c4fb3a02bb8443bc" kindref="member">estimated_foot_force</ref><sp/>=<sp/>add_vec_vec(</highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pos_error_with_gains,<sp/>fff_with_gains,<sp/></highlight><highlight class="stringliteral">&quot;est_f_&quot;</highlight><highlight class="normal"><sp/>+<sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1a8094365ea991d0c5d1f54d8ff75bff86" kindref="member">leg_name</ref>)</highlight></codeline>
<codeline lineno="135"><highlight class="normal"></highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1acb3c2792b4b35c6b7606023adbc09001" kindref="member">total_error</ref><sp/>=<sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1ac084d227c1362c85e910196812864ec4" kindref="member">pd_error</ref></highlight></codeline>
<codeline lineno="138"><highlight class="normal"></highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1ac02390fb0ab1a6c9c4fb3a02bb8443bc" kindref="member">estimated_foot_force</ref><sp/>=<sp/>add_vec_vec(pos_error_with_gains,<sp/>zero_vec(</highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>6,<sp/></highlight><highlight class="stringliteral">&quot;zero_vec_est_f&quot;</highlight><highlight class="normal"><sp/>+<sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1a8094365ea991d0c5d1f54d8ff75bff86" kindref="member">leg_name</ref>),<sp/></highlight><highlight class="stringliteral">&quot;est_f_&quot;</highlight><highlight class="normal"><sp/>+<sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1a8094365ea991d0c5d1f54d8ff75bff86" kindref="member">leg_name</ref>)</highlight></codeline>
<codeline lineno="141"><highlight class="normal"></highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>control_torques<sp/>=<sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1ac7abf513267b2626ce9fd191a7d7e061" kindref="member">_compute_control_torques</ref>()</highlight></codeline>
<codeline lineno="143"><highlight class="normal"></highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>control_torques</highlight></codeline>
<codeline lineno="145"><highlight class="normal"></highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">record_data(self,<sp/>robot):</highlight></codeline>
<codeline lineno="147"><highlight class="normal"></highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>robot.add_trace(</highlight><highlight class="stringliteral">&quot;rel_pos_foot_&quot;</highlight><highlight class="normal"><sp/>+<sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1a8094365ea991d0c5d1f54d8ff75bff86" kindref="member">leg_name</ref>,<sp/></highlight><highlight class="stringliteral">&quot;sout&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>robot.add_ros_and_trace(&quot;rel_pos_foot_&quot;<sp/>+<sp/>self.leg_name,<sp/>&quot;sout&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="150"><highlight class="normal"></highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>robot.add_trace(</highlight><highlight class="stringliteral">&quot;rel_vel_foot_&quot;</highlight><highlight class="normal"><sp/>+<sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1a8094365ea991d0c5d1f54d8ff75bff86" kindref="member">leg_name</ref>,<sp/></highlight><highlight class="stringliteral">&quot;sout&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>robot.add_ros_and_trace(&quot;rel_vel_foot_&quot;<sp/>+<sp/>self.leg_name,<sp/>&quot;sout&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="153"><highlight class="normal"></highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>robot.add_trace(</highlight><highlight class="stringliteral">&quot;pos_error_&quot;</highlight><highlight class="normal"><sp/>+<sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1a8094365ea991d0c5d1f54d8ff75bff86" kindref="member">leg_name</ref>,<sp/></highlight><highlight class="stringliteral">&quot;sout&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>robot.add_ros_and_trace(&quot;pos_error_&quot;<sp/>+<sp/>self.leg_name,<sp/>&quot;sout&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="156"><highlight class="normal"></highlight></codeline>
<codeline lineno="157"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>robot.add_trace(</highlight><highlight class="stringliteral">&quot;vel_error_&quot;</highlight><highlight class="normal"><sp/>+<sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1a8094365ea991d0c5d1f54d8ff75bff86" kindref="member">leg_name</ref>,<sp/></highlight><highlight class="stringliteral">&quot;sout&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>robot.add_ros_and_trace(&quot;vel_error_&quot;<sp/>+<sp/>self.leg_name,<sp/>&quot;sout&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="159"><highlight class="normal"></highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>robot.add_trace(</highlight><highlight class="stringliteral">&quot;est_f_&quot;</highlight><highlight class="normal"><sp/>+<sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1a8094365ea991d0c5d1f54d8ff75bff86" kindref="member">leg_name</ref>,<sp/></highlight><highlight class="stringliteral">&quot;sout&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>robot.add_ros_and_trace(&quot;est_f_&quot;<sp/>+<sp/>self.leg_name,<sp/>&quot;sout&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="162"><highlight class="normal"></highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1ad8b54c7826ccaba33e7bb99e13b1e177" kindref="member">rct_args</ref>[</highlight><highlight class="stringliteral">&quot;kf&quot;</highlight><highlight class="normal">]<sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1ad8b54c7826ccaba33e7bb99e13b1e177" kindref="member">rct_args</ref>[</highlight><highlight class="stringliteral">&quot;fff&quot;</highlight><highlight class="normal">]<sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">):</highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>robot.add_trace(</highlight><highlight class="stringliteral">&quot;total_error_&quot;</highlight><highlight class="normal"><sp/>+<sp/>self.<ref refid="classpython_1_1dg__tools_1_1leg__impedance__control_1_1leg__impedance__controller_1_1LegImpedanceController_1a8094365ea991d0c5d1f54d8ff75bff86" kindref="member">leg_name</ref>,<sp/></highlight><highlight class="stringliteral">&quot;sout&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>robot.add_ros_and_trace(&quot;total_error_&quot;<sp/>+<sp/>self.leg_name,<sp/>&quot;sout&quot;)</highlight><highlight class="normal"></highlight></codeline>
    </programlisting>
    <location file="python/dg_tools/leg_impedance_control/leg_impedance_controller.py"/>
  </compounddef>
</doxygen>
